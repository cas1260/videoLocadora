*****************************************
*                                       *
* ASPR000.PRG - ARQUIVO DE PROCEDURES   *
*                                       *
*****************************************
FUNCTION SUBMENU										&& menu pop-up c/ mensagens

	PARAMETERS VCONTOP,VOPCOES,VMSG,VLIN,VCOL,VLIMPA

	PRIVATE VOPCAO,VLINM

	IF VLIMPA
	@  8, 2 CLEAR TO 20,77
	ELSE
         @ 16, 2 CLEAR TO 20,77
	ENDIF
        VLINM = IIF(VLIN+VCONTOP<19,VLIN+VCONTOP,15)
        SOBRA(VLIN,VCOL,VLINM+1,VCOL+16,"W+/G","I/G")
*                       @ VLIN,VCOL TO VLINM+1,VCOL+16 
	KEYBOARD CHR(31)

        VOPCAO = ACHOICE (VLIN+1,VCOL+1,VLINM,VCOL+15,VOPCOES,.T.,"OPMSG")

        SOBRAL(VLIN,VCOL,VLINM+1,VCOL+16,"I/G","W+/G")
	RETURN VOPCAO

*** fim da funcao SUBMENU

FUNCTION TITULO										&& prepara tela
	PARAMETERS VTIT1,VTIT2

	PRIVATE VCOLOR

	VCOLOR = SETCOLOR()
*	SET COLOR TO &VCTITU

*	@  2, 2 CLEAR TO 3,66
*	@  2,68 CLEAR TO 3,77
	CENTRA(2,2,66,VTIT1)
       @ 2,68 SAY DATE()
	CENTRA(3,2,66,VTIT2)
	CENTRA(3,68,77,DIASEM(DATE()))

       SETCOLOR(VCOLOR)
       RETURN 0

*** fim da funcao TITULO

FUNCTION RODAPE

	PARAMETERS VMSG,VPISCA

	PRIVATE VCOLOR

	VCOLOR = SETCOLOR()

	SET COLOR TO &VCTITU
	@ 22, 2 SAY SPACE(76)
	
	IF VPISCA
		SET COLOR TO &VCPISC
	ENDIF

	CENTRA(22,2,77,VMSG)

	SETCOLOR(VCOLOR)
	RETURN 0

*** fim da funcao RODAPE

FUNCTION ENVMSG									&& apresenta mensagem de advertencia

	PARAMETERS VMSG1,VMSG2,VPISCMSG,VPISCPE,VSN,VNAOPARA

	PRIVATE VCOLOR1,VCOLOR2,VPOS,VRESP,VLOOP
	SET CURSO OFF
	CLEAR TYPEAHEAD
	
	VRESP = " "
	VCOLOR1 = SETCOLOR()

	@ 11, 6 TO 13,73 DOUBLE
*	SOBRA1(11,6,13,73,"W/B","I/B") 
	SET COLOR TO &VCTITU
	@ 12,7 SAY SPACE(66)

	IF VPISCMSG
		SET COLOR TO &VCPISC
	ENDIF

	VPOS = CENTRA(12,7,72,VMSG1)
*	RODAPE(VMSG2,VPISCPE)

	IF VSN
		SET CURSOR ON
		VCURS = .T.

		VCOLOR2 = SETCOLOR()
		
		IF VPISCMSG
			VCSN = VCPISC+"*"
		ELSE
			VCSN = VCTITU+"*"
		ENDIF
		
		SET COLOR TO &VCSN
		
		@ 12,VPOS+LEN(VMSG1)+1 GET VRESP PICTURE "!" VALID VRESP$"SN"
		READ
		CLEAR GETS
		
		SET COLOR TO VCOLOR2
		
		SET CURSOR OFF
		VCURS = .F.
	ENDIF

	SETCOLOR(VCOLOR1)
	
	IF .NOT. VNAOPARA
		VTECLA = 0
		DO WHILE VTECLA # 13 .AND. VTECLA # 27
			SET CURSO OFF
			VTECLA = INKEY(0) 
			SET CURSO ON
		ENDDO
	ENDIF
	SET CURSO ON
	RETURN VRESP
	
*** fim da funcao ENVMSG
			
FUNCTION TESTATIP

	PARAMETERS VTIP
	
	PRIVATE VTESTATIP,VTELA,VAREA
	
	VAREA = STR(SELECT(),1)
	
	SELECT 2
	SEEK VTIP
	
	IF EOF()
		VTESTATIP = .F.
		SAVE SCREEN TO VTELA
		ENVMSG("O tipo "+VTIP+" nao esta cadastrado!",VENTER,.F.,.T.,.F.,.F.)
		RESTORE SCREEN FROM VTELA
	ELSE
		VTESTATIP = .T.
	ENDIF
	
	SELECT &VAREA
	
	RETURN VTESTATIP
	
*** fim da funcao TESTATIP

FUNCTION QUERIMPR

	PRIVATE VTELA,VOPCOES[2],VMSG[2],VOPCAO

	SAVE SCREEN TO VTELA

	RODAPE("F1  Ajuda    F2  Encerra processamento    ESC  Abandona pesquisa",.F.)

	VOPCOES[1] = "Video"
	VOPCOES[2] = "Impressora"

	VMSG[1] = ""
	VMSG[2] = ""

	VOPCAO = submenu(2,VOPCOES,VMSG,10,35,.F.)
	
	RESTORE SCREEN FROM VTELA
	
	RETURN VOPCAO
	
*** fim da funcao QUERIMPR

FUNCTION ENTRACOD						&& entra codigo do credenciado ou empresa

	PRIVATE VARQ,VMSG,VCOD
	
	VARQ = ALIAS()
	
	IF VARQ = "CREDENC"
		VMSG = "o credenciado"
		
	ELSE
		VMSG = "a empresa"
	ENDIF
	
	RODAPE(VTECBAS,.F.)
	
	VCOD = "    "

	SET CURSOR ON
	VCURS = .T.

	IF VMSG="o credenciado"
		SET KEY-3 TO PESQCRED
	ENDIF
	
	@  6,20 SAY "Entre o codigo d"+VMSG+": " GET VCOD PICTURE "9999" VALID TESTACOD(VCOD,VARQ,.T.,.F.)
	READ
	CLEAR GETS
	
	IF VMSG="o credenciado"
		SET KEY-3 
	ENDIF	
	
	SET CURSOR OFF
	VCURS = .F.
	
	RETURN VCOD
	
*** fim da funcao ENTRACOD()

FUNCTION TESTACOD								&& verifica existencia de codigo

	PARAMETERS VCOD,VARQ,VMSG,VRDP,VCAMPO
	PRIVATE VTELA,VTESTE,VARQANT,VMENS,VMEM
	PUBLIC VRESUL,VMENS1

	IF VCURS
		SET CURSOR OFF
		VCURS = .F.
		VMEM = .T.
		
	ELSE
		VMEM = .F.
	ENDIF
	
	VARQANT = DBF()
	
	SELECT &VARQ
	SEEK VCOD

	IF EOF()
		
		IF VMSG
			DO NAOCOD WITH VCOD
		ENDIF
		
		VTESTE = .F.

	ELSE
		VTESTE = .T.
	ENDIF

	IF VRDP
		IF VTESTE
			
			VMENS = &VCAMPO
			VRESUL= &VCAMPO

			IF DBF()="USUARIOS"

				IF.NOT. ATIVO
					VMENS=VMENS+" DESATIVADO EM "+DTOC(DTDESATIVA)
					VMENS1=VMENS+" DESATIVADO EM "+DTOC(DTDESATIVA)
					SOM()
				ENDIF
			ENDIF
			
		ELSE
			VMENS = "Codigo inexistente"
		ENDIF

		SAVE SCREEN TO VTELA
		RODAPE(VMENS,.F.)
		DO ESPERA
		RESTORE SCREEN FROM VTELA
		
	ENDIF
	
	SELECT &VARQANT
	
	IF VMEM
		SET CURSOR ON
		VCURS = .T.
	ENDIF

	RETURN VTESTE
	
*** fim da funcao TESTACOD()



FUNCTION TESTACO								&& verifica existencia de codigo

	PARAMETERS VCOD,VARQ,VMSG,VRDP,VCAMPO
	PRIVATE VTELA,VTESTE,VARQANT,VMENS,VMEM
	PUBLIC VRESUL,VMENS1

*	IF VCURS
   	SET CURSOR OFF
		VCURS = .F.
		VMEM = .T.
		
*	ELSE
		VMEM = .F.
*	ENDIF
	
	VARQANT = DBF()
	
	SELECT &VARQ
	SEEK VCOD

	IF .NOT. EOF()
		
		IF VMSG
			DO SIMCOD WITH VCOD
		ENDIF
		
		VTESTE = .F.

	ELSE
		VTESTE = .T.
	ENDIF

	IF VRDP
		IF VTESTE
			
			VMENS = &VCAMPO
			VRESUL= &VCAMPO

			IF DBF()="USUARIOS"

				IF.NOT. ATIVO
					VMENS=VMENS+" DESATIVADO EM "+DTOC(DTDESATIVA)
					VMENS1=VMENS+" DESATIVADO EM "+DTOC(DTDESATIVA)
					SOM()
				ENDIF
			ENDIF
			
		ELSE
			VMENS = "Codigo inexistente"
		ENDIF

		SAVE SCREEN TO VTELA
*		RODAPE(VMENS,.F.)
		DO ESPERA
		RESTORE SCREEN FROM VTELA
		
	ENDIF
	
	SELECT &VARQANT
	
	IF VMEM
		SET CURSOR ON
		VCURS = .T.
	ENDIF
   	SET CURSOR ON
	RETURN VTESTE
	
*** fim da funcao TESTACOD()


FUNCTION ENTRAGUIA						&& entra numero de guia de consulta

	PRIVATE VTIPOG,VGUIA
	
	RODAPE(VTECBAS,.F.)
	
	VTIPOG = " "
	VGUIA = SPACE(6)

	SET CURSOR ON
	VCURS = .T.

	@  6,20 SAY "Entre o tipo da guia:  " GET VTIPOG PICTURE "!" VALID VTIPOG$"ACPS"
	@  8,20 SAY "Entre o numero da guia:" GET VGUIA PICTURE "@R 999.999" VALID TESTAGUIA(VTIPOG,VGUIA,"GUIAS",.T.)

	READ
	CLEAR GETS
	
	SET CURSOR OFF
	VCURS = .F.
	
	RETURN VTIPOG+VGUIA
	
*** fim da funcao ENTRAGUIA()

FUNCTION TESTAGUIA						&& verifica existencia de numero de guia

	PARAMETERS VTIPOG,VGUIA,VARQ,VMSG
	PRIVATE VTELA,VTESTE,VARQANT,VMEM

	IF VCURS
		SET CURSOR OFF
		VCURS = .F.
		VMEM = .T.
		
	ELSE
		VMEM = .F.
	ENDIF
	
	VARQANT = DBF()
	SELECT &VARQ
		
	SET SOFTSEEK ON
	SEEK VTIPOG+VGUIA

	IF VTIPOG+VGUIA=TIPOGUIA+GUIAINI
		VTESTE = .T.

	ELSE
		SKIP -1

		IF .NOT. BOF() .AND. VGUIA>=GUIAINI .AND. VGUIA<=GUIAFIM .AND. VTIPOG=TIPOGUIA
			VTESTE = .T.
		ELSE
			VTESTE = .F.
		ENDIF
	ENDIF
	
	SET SOFTSEEK OFF
	
	IF .NOT. VTESTE .AND. VMSG
		SAVE SCREEN TO VTELA
		ENVMSG("Guia nao cadastrada!","",.F.,.F.,.F.,.T.)
		DO ESPERA
		RESTORE SCREEN FROM VTELA
	ENDIF
	
	IF VMEM
		SET CURSOR ON
		VCURS = .T.
	ENDIF

	SELECT &VARQANT
	
	RETURN VTESTE
	
*** fim da funcao TESTAGUIA()

FUNCTION SOM

	PARAMETERS VTIPO
	TONE(3000,07)
	TONE(500,07)
	
	RETURN .T.

*** procedures que enviam diversas mensagens de erro e advertencia

PROCEDURE IMPR

*	ENVMSG("Ligue e prepare a impressora.","Tecle ENTER para continuar ou ESC para desistir.",.T.,.F.,.F.,.F.)
	RODAPE("Tecle ENTER para continuar ou ESC para desistir",.F.)
	IF .NOT. ISPRINTER() .AND. LASTKEY() # 27
		ENVMSG("Impressora desligada.","Ligue a impressora ou tecle ESC para desistir.",.T.,.F.,.F.,.T.)
		DO WHILE INKEY()#27 .AND. .NOT. ISPRINTER()
		ENDDO
	ENDIF
	
	IF ISPRINTER() .AND. LASTKEY()#27
		DO AGIMPR
	ENDIF
	
	RETURN

PROCEDURE AGIMPR

	ENVMSG("Imprimindo...","Tecle ESC para interromper impressao.",.F.,.T.,.F.,.T.)
	RETURN
	
PROCEDURE AGUARDE

	ENVMSG("Aguarde um momento, por favor.","",.T.,.F.,.F.,.T.)
	RETURN

PROCEDURE NAOCOD						&& envia msg de codigo nao cadastrado

	PARAMETERS VCOD
	PRIVATE VTELA
	
	SAVE SCREEN TO VTELA
	ENVMSG("O codigo "+VCOD+" nao esta cadastrado!",VENTER,.F.,.T.,.F.,.F.)
	RESTORE SCREEN FROM VTELA
	
	RETURN
	
PROCEDURE SIMCOD						&& envia msg de codigo nao cadastrado

	PARAMETERS VCOD
*	PRIVATE VTELA
	
	SAVE SCREEN TO VTELA
*	VCOD=STR(VCOD)
	ENVMSG("O codigo ja esta cadastrado!","",.F.,.T.,.F.,.F.)
	RESTORE SCREEN FROM VTELA
	
	RETURN	

PROCEDURE ESPERA										&& da' um tempo

	PRIVATE VLOOP

	VLOOP = VINSTIME
	DO WHILE VLOOP > 0
		VLOOP = VLOOP - 1
	ENDDO

	RETURN
	
*** fim da procedure ESPERA

FUNCTION CRIPTA							&& codifica a senha

	PARAMETERS VPW
	PRIVATE VCONT,VCPW,VNL

	VCONT = 1
	VCPW  = ""

	DO WHILE VCONT <= LEN(VPW)

		VNL = ASC(SUBSTR(VPW,VCONT,1))
	
		VNL = IIF(VNL<78, 155-VNL, VNL-13)
		VNL = VNL + 128
		
		VCPW = VCPW + CHR(VNL)

		VCONT = VCONT+1
	
	ENDDO

	RETURN VCPW

*** fim da fun‡ao CRIPTA

FUNCTION MOSCIDADE					&& mostra tabela de cidades p/ escolha

	PARAMETERS VCHAVE

	PRIVATE VCOLOR,VTELA,VCAMPOS[2],VCABEC[2],VLIN,VCOL,VRET

	VLIN = ROW()
	VCOL = COL()
	
	SAVE SCREEN TO VTELA
	VCOLOR = SETCOLOR()

	RODAPE(CHR(24)+CHR(25)+CHR(26)+CHR(27)+" examina  ENTER escolhe cidade  ESC desiste",.F.)

	SET COLOR TO &VCDBED
	@ 5,30 CLEAR TO 20,75
	@ 5,29 TO 20,29 DOUBLE
	@ 5,76 TO 20,76 DOUBLE

	VCABEC[1] = "CODIGO"
	VCABEC[2] = "CIDADE"
	
	VCAMPOS[1] = "CODCIDADE"
	VCAMPOS[2] = "CIDADE"

	SEEK VCHAVE
	
	IF .NOT. EOF()
		VCIDPOS = CIDADE
	ELSE
		VCIDPOS = ""
	ENDIF
	
	SET ORDER TO 2
	
	IF EMPTY(VCIDPOS)
		GOTO TOP
	ELSE
		SEEK VCIDPOS
	ENDIF
	
	dbedit(5,30,20,75,VCAMPOS,"ACHALETRA",0,VCABEC)

	IF LASTKEY() # 27
		VRET = CODCIDADE
	ELSE
		VRET = ""
		KEYBOARD CHR(13)
		VUPD = .T.
	ENDIF
	
	SET ORDER TO 1

	@ VLIN,VCOL
	SETCOLOR(VCOLOR)
	RESTORE SCREEN FROM VTELA

	RETURN VRET
	
*********************	
FUNCTION MOSCLIENTE
********************
	PARAMETERS VCHAVE

	VARQ=ALIAS()

*	USE CLIENTE INDEX CLIENTEA INDEX CLIENTEB

	SELE CLIENTE	

	PRIVATE VCOLOR,VTELA,VCAMPOS[4],VCABEC[4],VLIN,VCOL,VRET

	VLIN = ROW()
	VCOL = COL()
	
        SAVE SCREEN TO VTELA12
	VCOLOR = SETCOLOR()

*	RODAPE(CHR(24)+CHR(25)+CHR(26)+CHR(27)+" examina  ENTER escolhe Cliente  ESC desiste",.F.)

	SET COLOR TO &VCDBED
	@ 10,28 CLEAR TO 10,75
	@ 10,29 TO 20,29 DOUBLE
	@ 10,76 TO 20,76 DOUBLE

	VCABEC[1] = "NOME"
	VCABEC[2] = "CODIGO"
	VCABEC[3] = "DEPENDENTE 1"
	VCABEC[4] = "DEPENDENTE 2"	
	
	VCAMPOS[1] = "NOME"
	VCAMPOS[2] = "CODCLI"
	VCAMPOS[3] = "DEP1" 
	VCAMPOS[4] = "DEP2"	

	SEEK VCODCLI
	
	IF .NOT. EOF()
		VCODCLI = CODCLI
	ELSE
		VCODCLI = ""
	ENDIF
	
	SET ORDER TO 2
	
	IF EMPTY(VCODCLI)
		GOTO TOP
	ELSE
		SEEK VCODCLI
	ENDIF
	VKEY = ""
	@ 09,24 TO 22,76 DOUBLE
	VCOR=SETCOLOR()
	SET COLOR TO I/W
		@ 21,25 SAY SPACE(51)
		@ 21,25 SAY UPPER(VKEY)
	SET COLOR TO I*/W				
		@ 21,25+LEN(VKEY) SAY "_"
	SET COLOR TO &VCOR
	DBEDIT(10,25,20,75,VCAMPOS,"ACHALETRA",0,VCABEC)

	IF LASTKEY() # 27
		VCODCLI = CODCLI
		KEYBOARD CHR(13)		
	ELSE
		VRET = ""
		KEYBOARD CHR(13)
		VUPD = .T.
	ENDIF
	
	SET ORDER TO 1

	@ VLIN,VCOL
	SETCOLOR(VCOLOR)
        RESTORE SCREEN FROM VTELA12
       
	RETURN VCODCLI
****************
FUNCTION MOSLOCA
****************
PARAMETERS VCHAVE

VARQ=ALIAS()

SELE LOCACAO

PRIVATE VCOLOR,VTELA,VCAMPOS[6],VCABEC[6],VLIN,VCOL,VRET

VLIN = ROW()
VCOL = COL()
	
SAVE SCREEN TO VTELA
VCOLOR = SETCOLOR()

RODAPE(CHR(24)+CHR(25)+CHR(26)+CHR(27)+" examina  ENTER escolhe locacao  ESC desiste",.F.)

SET COLOR TO &VCDBED
@ 10,28 CLEAR TO 10,75
@ 10,29 TO 20,29 DOUBLE
@ 10,76 TO 20,76 DOUBLE

VCABEC[1] = "NOME"
VCABEC[2] = "CODIGO"
VCABEC[3] = "LOCACAO"
VCABEC[4] = "DEVOLUCAO"	
VCABEC[5] = "VALOR"	
VCABEC[6] = "LANCAMENTO"	
	
VCAMPOS[1] = "NOME"
VCAMPOS[2] = "CODCLI"
VCAMPOS[3] = "DTLOC" 
VCAMPOS[4] = "DEVOLUCAO"	
VCAMPOS[5] = "VALOR" 
VCAMPOS[6] = "LANCAMENTO" 

SET ORDER TO 4
	
IF EMPTY(VCODCLI)
	GOTO TOP
ELSE
 	SEEK VCODCLI
ENDIF
	
DBEDIT(10,25,20,75,VCAMPOS,"ACHALETRA",0,VCABEC)

IF LASTKEY() # 27
	VCODCLI = CODCLI
	KEYBOARD CHR(13)		
ELSE
	VRET = ""
	KEYBOARD CHR(13)
	VUPD = .T.
ENDIF
	
SET ORDER TO 1

@ VLIN,VCOL
SETCOLOR(VCOLOR)
RESTORE SCREEN FROM VTELA

SELE &VARQ

RETURN VCODCLI

****************
FUNCTION MOSPROD
****************
PARAMETERS VCHAVE

VARQ=ALIAS()

SELE PRODUTO

PRIVATE VCOLOR,VTELA,VCAMPOS[4],VCABEC[4],VLIN,VCOL,VRET

VLIN = ROW()
VCOL = COL()
	
SAVE SCREEN TO VTELA
VCOLOR = SETCOLOR()

RODAPE(CHR(24)+CHR(25)+CHR(26)+CHR(27)+" examina  ENTER Confirmar  ESC desiste",.F.)

SET COLOR TO &VCDBED
@ 10,28 CLEAR TO 10,75
@ 10,29 TO 20,29 DOUBLE
@ 10,76 TO 20,76 DOUBLE

VCABEC[1] = "DESCRICAO"
VCABEC[2] = "CODIGO"
VCABEC[3] = "ATORES"
	
VCAMPOS[1] = "DESCRICAO"
VCAMPOS[2] = "CODPROD" 
VCAMPOS[3] = "ATORES" 

SEEK VCOD[X]
	
IF .NOT. EOF()
	VCODPROD = CODPROD
ELSE
	VCODPROD = ""
ENDIF
	
SET ORDER TO 2
	
GOTO TOP
@ 09,24 TO 21,76 DOUBLE
DBEDIT(10,25,20,75,VCAMPOS,"ACHALETRA",0,VCABEC)

IF LASTKEY() # 27

	VCODIGO=CODPROD
	KEYBOARD CHR(13)		
ELSE
	VRET = ""
	KEYBOARD CHR(13)
	VUPD = .T.
ENDIF
	
SET ORDER TO 1

@ VLIN,VCOL
SETCOLOR(VCOLOR)
RESTORE SCREEN FROM VTELA

SELE &VARQ

RETURN VCODIGO

*******************
FUNCTION MOSPRODUTO
*******************
PARAMETERS VCHAVE

VARQ=ALIAS()

USE PRODUTO INDEX PRODUTOA INDEX PRODUTOB

PRIVATE VCOLOR,VTELA,VCAMPOS[4],VCABEC[4],VLIN,VCOL,VRET

VLIN = ROW()
VCOL = COL()
	
SAVE SCREEN TO VTELA
VCOLOR = SETCOLOR()

RODAPE(CHR(24)+CHR(25)+CHR(26)+CHR(27)+" examina  ENTER escolhe Produto  ESC desiste",.F.)

SET COLOR TO &VCDBED
@ 10,28 CLEAR TO 10,75
@ 10,29 TO 20,29 DOUBLE
@ 10,76 TO 20,76 DOUBLE

VCABEC[1] = "DESCRICAO"
VCABEC[2] = "CODIGO"
VCABEC[3] = "ATORES"
	
VCAMPOS[1] = "DESCRICAO"
VCAMPOS[2] = "CODPROD"
VCAMPOS[3] = "ATORES" 

SEEK VCODIGO
	
IF .NOT. EOF()
	VCODIGO = CODPROD
ELSE
	VCODIGO = ""
ENDIF
	
SET ORDER TO 2
	
IF EMPTY(VCODIGO)
	GOTO TOP
ELSE
	SEEK VCODIGO
ENDIF
VKEY = "" 
VCOR=SETCOLOR()
SET COLOR TO I/W
@ 21,25 SAY SPACE(51)
	@ 21,25 SAY UPPER(VKEY)
SET COLOR TO I*/W				
	@ 21,25+LEN(VKEY) SAY "_"
SET COLOR TO &VCOR
@ 09,24 TO 22,76 DOUBLE
DBEDIT(10,25,20,75,VCAMPOS,"ACHALETRA",0,VCABEC)

IF LASTKEY() # 27
	VCODIGO = CODPROD
	KEYBOARD CHR(13)		
ELSE
	VRET = ""
	KEYBOARD CHR(13)
	VUPD = .T.
ENDIF
	
SET ORDER TO 1

@ VLIN,VCOL
SETCOLOR(VCOLOR)
RESTORE SCREEN FROM VTELA

SELE &VARQ

RETURN VCODIGO


FUNCTION DATA800

PARAMETERS VDATA8

IF DAY(VDATA8)>=20
	VMESANO8=SUBSTR(DTOC(VDATA8+12),4,5)
ELSE
	VMESANO8=SUBSTR(DTOC(VDATA8),4,5)
ENDIF

VDE8=SUBSTR(DTOC(VDATA8-365),4,5)
VATE8=SUBSTR(DTOC(VDATA8),4,5)
VMESANO8=VMESANO8+VDE8+VATE8


RETURN VMESANO8

*** Fim da funcao DATA800

FUNCTION TESTAMED

PARAMETERS VMED

USE AS002 INDEX AS002A

SEEK VMED

IF .NOT.EOF()
	OK=.T.
	VNOMEMED=NOME
ELSE
	OK=.F.
	VNOMEMED=""
ENDIF
RETURN OK

*** Fim da funcao TESTAMED

FUNCTION TESTAUSU

PARAMETERS VCODIGO

USE AS003 INDEX AS003A

SEEK SUBSTR(VCODIGO,1,11)+"00"

IF .NOT. EOF()
	IF ATIVO
		VTITATIV="ATIVO"
	ELSE
		VTITATIV="DESAT."+DTOC(DTDESATIVA)
	ENDIF
	
	VTIT8=NOME+VTITATIV
	
	SEEK VUSUARIO
	
	IF .NOT. EOF()
		IF ATIVO
			VDEPATIV="ATIVO"
		ELSE
			VDEPATIV="DESAT."+DTOC(DTDESATIVA)
		ENDIF
	
		VDEP8=NOME+VDEPATIV
		OK=.T.

	ELSE
	
		VDEP8=""
		VDEPATIV=""
		VDEPDATA=""
		OK=.F.

	ENDIF
	
ELSE
	VDEP8=""
	OK=.F.
	VTIT8=""
ENDIF

RETURN OK

***Fim da funcao TESTAUSU

FUNCTION DEVE7777

PARAMETERS VMATRICULA

USE AS049 INDEX AS049A

DEVE=""

SEEK VMATRICULA

IF .NOT. EOF()
	DO WHILE .NOT. EOF() .AND. MATRICULA=VMATRICULA
		DEVE=DEVE+SUBSTR(MESANO,3,2)+"/"+SUBSTR(MESANO,1,2)+" "
		SKIP
	ENDDO
	VMENSA="PESSOA FISICA DEVEDOR EM: "+DEVE
ELSE

	VMENSA="PESSOA FISICA EM DIA"+DEVE
	
ENDIF

RETURN VMENSA

*** Fim da funcao DEVE7777

FUNCTION SENHA800

PARAMETERS VDATA

USE AS027

VSENHA=SENHA
VCREDENC=CREDENC
VEMPRESA=EMPRESA

V1=VAL(SUBSTR(VSENHA,1,1))+1
V2=VAL(SUBSTR(VSENHA,2,1))+1
V3=VAL(SUBSTR(VSENHA,3,1))+1
V4=VAL(SUBSTR(VSENHA,4,1))+1
V5=VAL(SUBSTR(VSENHA,5,1))+1
V6=VAL(SUBSTR(VSENHA,6,1))-1
V7=VAL(SUBSTR(VSENHA,7,1))-1
V8=VAL(SUBSTR(VSENHA,8,1))-1
V9=VAL(SUBSTR(VSENHA,9,1))-1
V0=VAL(SUBSTR(VSENHA,10,2))-1


VALOR=(V3*V8)+(V2*V7)+(V1+V2+V3+V0+V6)

DO CASE

	CASE VALOR>90
	
		DO WHILE VALOR>=90
			VALOR=VALOR-5
		ENDDO
		
	CASE VALOR<65
	
		DO WHILE VALOR<=65
			VALOR=VALOR+5
		ENDDO
		
ENDCASE

X1=LTRIM(STR(V1+V0+V2+V9+V5))
X2=LTRIM(STR(V3+V7+V4+V6+V5))
V11=SUBSTR(X2,1,2)
V12=SUBSTR(X1,1,2)
Y1=VAL(SUBSTR(DTOC(DATE()),1,2))
Y2=VAL(SUBSTR(DTOC(DATE()),4,2))
Y3=VAL(SUBSTR(DTOC(DATE()),7,2))
Y4=LTRIM(STR(INT((Y1+Y2+Y3/9))))
V13=SUBSTR(Y4,1,1)

** V13=SUBSTR(LTRIM(STR((VAL(SUBSTR(DTOC(DATE()),1,2)+VAL(SUBSTR(DTOC(DATE()),4,2)+VAL(SUBSTR(DTOC(DATE()),7,2))/(V1+V0+V5+V9)),1,1) */
V14=CHR(VALOR)
V15=V11+V12+V13+V14

IF V1=10
	V1="1"
ELSE
	V1=LTRIM(STR(V1))
ENDIF

IF V2=10
	V2="2"
ELSE
	V2=LTRIM(STR(V2))	
ENDIF

IF V3=10
	V3="3"
ELSE
	V3=LTRIM(STR(V3))
ENDIF

IF V4=10
	V4="4"
ELSE
	V4=LTRIM(STR(V4))
ENDIF

IF V5=10
	V5="5"
ELSE
	V5=LTRIM(STR(V5))
ENDIF

IF V6<=0
	V6="6"
ELSE
	V6=LTRIM(STR(V6))
ENDIF

IF V7<=0
	V7="7"
ELSE
	V7=LTRIM(STR(V7))
ENDIF

IF V8<=0
	V8="8"
ELSE
	V8=LTRIM(STR(V8))
ENDIF

IF V9<=0
	V9="9"
ELSE
	V9=LTRIM(STR(V9))
ENDIF

IF V0<=0
	V0="10"
ELSE
	V0=LTRIM(STR(V0))
ENDIF

REPLACE SENHA WITH V1+V2+V3+V4+V5+V6+V7+V8+V9+V0


RETURN V15

FUNCTION CABUTI
PARAMETERS VRELOP
	
IF VRELOP="1"
 						 
   @ PROW(),PCOL() SAY CHR(27)+CHR(15)

   @ PROW()+4,01 SAY "------------------   RESUMO   DOS  PROCEDIMENTOS  -----"
   @ PROW()  ,56 SAY "-------------            QTDE          % "
   @ PROW()+1,0  SAY " "    
	             
ELSE
							  
	 @ PROW(),PCOL() SAY CHR(27)+CHR(15)
     
    @ PROW()+4,01 SAY "------------------   RESUMO   DOS  PROCEDIMENTOS  -----"
    @ PROW()  ,56 SAY "----                    QTDE           VALOR        % (R$)   MEDIO/UNIT."
    @ PROW()+1,0  SAY " "    
	            
ENDIF
X=0					 
RETURN X

FUNCTION INDEXA

PARAMETERS VARQ

X=0

@ 22,10 SAY "REORGANIZANDO ARQ."+VARQ

RETURN X

FUNCTION LIMPAINDEX

PARAMETERS X

X=0

@ 22,10 SAY REPLICATE(" ",60)

RETURN X

FUNCTION PCMSO

PARAMETERS VADM,VNASCI,VPERIODICO,VGRAU

VDATA=DTOC(DATE())

VDATA=DTOC(DATE())
VDIAMES=SUBSTR(VDATA,1,6)
VANO1=ALLTRIM(STR(VAL(SUBSTR(VDATA,7,2))-18))
VANO2=ALLTRIM(STR(VAL(SUBSTR(VDATA,7,2))-45))
VDATA1=CTOD(VDIAMES+VANO1)
VDATA2=CTOD(VDIAMES+VANO2)

IF VNASCI>=VDATA2 .AND. VNASCI<=VDATA1

	DO CASE
	
		CASE VGRAU="1"
			VANO=2
		CASE VGRAU="2"
			VANO=2
		CASE VGRAU="3"
			VANO=2
		CASE VGRAU="4"
			VANO=2
			
	ENDCASE
		
ELSE

	DO CASE
	
		CASE VGRAU="1"
			VANO=1
		CASE VGRAU="2"
			VANO=1
		CASE VGRAU="3"
			VANO=1
		CASE VGRAU="4"
			VANO=1
			
	ENDCASE

ENDIF

IF VPERIODICO=CTOD("  /  /  ")

	VPERIOD=DTOC(VADM)
	DIAMES1=SUBSTR(VPERIOD,1,6)
	VANO3=ALLTRIM(STR(VAL(SUBSTR(VDATA,7,2))+VANO))
	VPERIOD=CTOD(DIAMES1+VANO3)

ELSE

	VPERIOD=DTOC(VPERIODICO)
	DIAMES1=SUBSTR(VPERIOD,1,6)
	VANO3=ALLTRIM(STR(VAL(SUBSTR(VDATA,7,2))+VANO))	
	VPERIOD=CTOD(DIAMES1+VANO3)
	
ENDIF

RETURN VPERIOD
		
FUNCTIO TELAW

PARAMETERS X,Y,VNOME
	
V=1	
	
DO WHILE X<Y
	
	IF V=1
setcolor(N/W,W/N,W/RB)
		@ X,5  SAY VNOME
		@ X,22 SAY VNOME
		@ X,39 SAY VNOME
		@ X,56 SAY VNOME
		V=2

	ELSE
setcolor(N/W,W/N,W/RB)		
		@ X,10 SAY VNOME
		@ X,27 SAY VNOME
		@ X,44 SAY VNOME
		@ X,61 SAY VNOME		
		V=1
			
	ENDIF
		
	X=X+2

ENDDO
	
RETURN X	

PROCEDURE DESTINO

PUBLIC VDEST

SAVE SCREEN TO VTELAD

VDEST=SPACE(1)
@ 15,10 CLEAR TO 20,60 
@ 15,10 TO 20,60 DOUBLE
@ 16,12 SAY "DESTINO: " GET VDEST PICTURE "9" VALID VDEST$"12"
@ 17,22 SAY "TELA..........<1>"
@ 18,22 SAY "IMPRESSORA....<2>"
READ

IF LASTKEY()#27

	IF VDEST="1"
		SET PRINTER TO &VARQIMP1
	ELSE
		SET PRINTER TO 
	ENDIF
	
ENDIF

RESTORE SCREEN FROM VTELAD

RETURN

PROCEDURE EDITA

SET PRINTER TO 

IF VDEST="1"

	SET DEVI TO SCREEN

	SET KEY -7 TO IMPVARQ

	SAVE SCREEN TO VTELAV
	SET PRINTER TO 						
*	@ 07,02 SAY "ARQUIVO EM EDICAO: "+VARQIMP+" / "+VARQIMP1
	@ 09,02 to 21,77 DOUBLE

	MEMOEDIT(MEMOREAD(VARQIMP),10,03,20,76,.F.,"",130,10,1,1,1,1)

	SET PRINTER TO 
						
	RESTORE SCREEN FROM VTELAV			
				
ENDIF

RETURN

PROCEDURE IMPVARQ

DO IMPR

TYPE &VARQIMP TO PRINT

SET KEY -7 TO

RETURN


PROCEDURE INIMP

@ PROW(),PCOL() SAY CHR(27)+CHR(64)

RETURN
	
PROCEDURE ALFACOBE

SET COLOR TO &VCTEXT
SET CURSOR ON

SELE 0
USE AS001 INDEX AS001A ALIAS EMPRESA

SELE 0
USE AS010 INDEX AS010A ALIAS AMB1

SELE 0
USE AS070 INDEX AS070A ALIAS COBE
SET RELATION TO CODIGOPROC INTO AMB1

SAVE SCREEN TO VTELAX

DO WHILE LASTKEY()#27
	
	@ 5,2 CLEAR TO 20,77
	
	VPLANO=SPACE(4)
	VCODEMP=SPACE(4)
	
	@ 07,10 SAY "Relatorio de Cobertura por Empresa/Plano"	
	@ 10,10 SAY "COD.EMPRESA: " GET VCODEMP PICTURE "9999" VALID VCODEMP#SPACE(4)
	@ 12,10 SAY "PLANO...: " GET VPLANO VALID VPLANO#SPACE(4)

	READ
	
	IF LASTKEY()#27

		SELE EMPRESA
		
		SEEK VCODEMP
		
		IF EOF()
		
			SAVE SCREEN TO VTELA
			ENVMSG("O codigo "+VCODEMP+" nao esta cadastrado!",VENTER,.F.,.T.,.F.,.F.)
			RESTORE SCREEN FROM VTELA			
			VOK=.F.

		ELSE 
		
			VNOMEMP=EMPRESA
			VOK=.T.
			
		ENDIF

		SELE COBE
	
		P=1
		PG=1
		SET DEVI TO PRINT
		VTPLANO=0
		DO WHILE .NOT. EOF() .AND. VOK
		
			IF PLANO=VPLANO .AND. CODEMP=VCODEMP
			
				IF P=1
					P=2				
					@ 01,01 SAY DATE()
					@ 01,30 SAY "TRANSCLINICA LTDA"
					@ 01,70 SAY TIME()
					@ 02,01 SAY "RELACAO DE PROCEDIMENTOS COBERTOS PLANO PERSONAL"
					@ 02,70 SAY "PAG."+LTRIM(STR(PG))
					@ 03,01 SAY REPLICATE("-",79)
					@ 05,01 SAY "COD.PROCED."
					@ 05,14 SAY "DESCRICAO"
					@ 05,47 SAY "CH"
					@ 05,65 SAY "CARENCIA"
					@ 05,76 SAY "FRAN"
										
					@ 06,01 SAY REPLICATE("=",11)
					@ 06,14 SAY REPLICATE("=",30)
					@ 06,47 SAY REPLICATE("=",13)
					@ 06,65 SAY REPLICATE("=",9)					
					@ 06,76 SAY REPLICATE("=",4)
					@ 08,01 SAY CHR(27)+CHR(14)+VPLANO+"  "+SUBSTR(VNOMEMP,1,35)
					@ 10,01 SAY ""
					
				ENDIF
				
				@ PROW()+1,01 SAY CODIGOPROC PICTURE "@R 99.99.999-9"
				@ PROW(),14 SAY SUBSTR(AMB1->DESPROC,1,30)
				@ PROW(),47 SAY AMB1->HONORARIOS+AMB1->CUSTOOP PICTURE "@E 9,999,999"				
				@ PROW(),65 SAY CARENCIA PICTURE "@E 99,999"								
				@ PROW(),76 SAY FRANQUIA
				VTPLANO=VTPLANO+1

				IF PROW()>=55
					P=1
					PG=PG+1
				ENDIF

			ENDIF
				
			SKIP
			
		ENDDO
		
		IF VTPLANO>0
		
			@ PROW()+3,01 SAY "TOTAL DE PROCEDIMENTOS CADASTRADOS........ "
			@ PROW()  ,46 SAY VTPLANO PICTURE "@E 999,999"
			EJECT
			
		ENDIF
		
	ENDIF
	
	SET DEVI TO SCREEN
	
ENDDO

RESTORE SCREEN FROM VTELAX

RETURN

PROCEDURE REDEIND

SET COLOR TO &VCTEXT
SET CURSOR ON

SELE 0
USE AS001 INDEX AS001A ALIAS EMPRESA

SELE 0
USE AS002 INDEX AS002A ALIAS MEDICO

SELE 0
USE AS061 INDEX AS061A ALIAS REDE
SET RELATION TO CODIGO INTO MEDICO

SAVE SCREEN TO VTELAX

DO WHILE LASTKEY()#27
	
	@ 5,2 CLEAR TO 20,77
	
	VCODEMP=SPACE(4)
	@ 07,10 SAY "Relacao de rede indicada por empresa/plano"
	@ 10,10 SAY "COD.EMPRESA: " GET VCODEMP PICTURE "9999" VALID VCODEMP#SPACE(4)
	READ
	
	IF LASTKEY()#27

		SELE EMPRESA
		
		SEEK VCODEMP
		
		IF EOF()
		
			SAVE SCREEN TO VTELA
			ENVMSG("O codigo "+VCODEMP+" nao esta cadastrado!",VENTER,.F.,.T.,.F.,.F.)
			RESTORE SCREEN FROM VTELA			
			VOK=.F.

		ELSE 
		
			VNOMEMP=EMPRESA
			VOK=.T.
			
		ENDIF

		SELE REDE

		P=1
		PG=1
		SET DEVI TO PRINT
		VTPLANO=0

		DO WHILE .NOT. EOF() .AND. VCODEMP=CODEMP .AND. VOK

			VPLANO=PLANO

			IF PLANO=VPLANO
			
				IF P=1

					P=2				
					@ 01,01 SAY DATE()
					@ 01,30 SAY "TRANSCLINICA LTDA"
					@ 01,70 SAY TIME()
					@ 02,01 SAY "RELACAO DE REDE CREDENCIADA/INDICADA"
					@ 02,70 SAY "PAG."+LTRIM(STR(PG))
					@ 03,01 SAY REPLICATE("-",79)
					@ 05,01 SAY "PLANO"
					@ 05,07 SAY "COD"
					@ 05,14 SAY "CREDENCIADO"
					@ 05,47 SAY "NIVEL"
					@ 05,53 SAY "VALOR"
					@ 05,73 SAY "MES/ANO"
					
					@ 06,01 SAY REPLICATE("=",4)
					@ 06,07 SAY REPLICATE("=",4)
					@ 06,14 SAY REPLICATE("=",30)
					@ 06,47 SAY REPLICATE("=",5)
					@ 06,53 SAY REPLICATE("=",15)		
					@ 06,73 SAY REPLICATE("=",7)			
					@ 08,01 SAY CHR(27)+CHR(14)+VNOMEMP
					@ 10,01 SAY ""
					
				ENDIF
				
				@ PROW()+1,01 SAY PLANO
				@ PROW(),07 SAY CODIGO
				IF CODIGO="9999"
					@ PROW(),14 SAY "REDE CREDENCIADA"
				ELSE
					@ PROW(),14 SAY SUBSTR(MEDICO->NOME,1,30)
				ENDIF
				@ PROW(),47 SAY NIVEL
				@ PROW(),53 SAY VALOR PICTURE "@E 9,999,999.99"
				@ PROW(),73 SAY SUBSTR(MESANO,3,2)+"/"+SUBSTR(MESANO,1,2)
				
				IF PROW()>=55
					P=1
					PG=PG+1
				ENDIF

			ENDIF
				
			SKIP
			
			IF VPLANO#PLANO
				@ PROW()+2,01 SAY ""
			ENDIF
			
		ENDDO
		
	ENDIF
	
	SET DEVI TO SCREEN
	
ENDDO

RESTORE SCREEN FROM VTELAX

RETURN

PROCEDURE TESTAETI

SAVE SCREEN TO VTELAETI

@ 11,05 CLEAR TO 13,75
@ 11,06 TO 13,74 DOUBLE

SIM="S"

DO WHILE SIM="S" .AND. LASTKEY()#27

	@ 12,08 SAY "TESTA ETIQUETA (S/N): " GET SIM PICTURE "!" VALID SIM$"SN"
	READ
	
	IF LASTKEY()#27 .AND. SIM="S"
	
		SET DEVI TO PRINT
		
		@ PROW(),01 SAY "XXXXXXXXXXXXXXXXXXXXXXXX"
		@ PROW()+1,01 SAY "XXXXXXXXXXXXXXXXXXXXXXXX"
		@ PROW()+1,01 SAY "XXXXXXXXXXXXXXXXXXXXXXXX"
		@ PROW()+1,01 SAY "XXXXXXXXXXXXXXXXXXXXXXXX"
		@ PROW()+1,01 SAY "XXXXXXXXXXXXXXXXXXXXXXXX"				
		@ PROW()+2,01 SAY ""
		
		SET DEVI TO SCREEN
		
	ENDIF
	
ENDDO

RESTORE SCREEN FROM VTELAETI

RETURN

PROCEDURE HORA
SAVE SCREEN TO VTELAH
@ 21,03 CLEAR TO 23,15 
@ 21,03 TO 23,15 DOUBLE
DO WHILE .T.
	SET CURSOR OFF
	@ 22,05 SAY TIME()
	IF INKEY()=27 
		EXIT
	ENDIF
ENDDO
SET CURSO ON
RESTORE SCREEN FROM VTELAH
RETURN

PROCEDURE CALENDARIO
***************
* CALENDARIO  *
***************
AS=SETCOLOR()
PRIVATE VTELACALE
SET CENTURY ON
SAVE SCREEN TO VTELACALE

VDATA1=CTOD("01"+SUBSTR(DTOC(DATE()),3,8))

SET CURSOR OFF
DO WHILE LASTKEY()#13 .AND. LASTKEY()#27
		@ 22,02 SAY SPACE(76)
		DIA="1"
		VDATA2=VDATA1
		SSS=SETCOLOR()
		LINHA=1
		VLINHA=11
		VNOMEMES=MES(VDATA1)
		VPOS=POS(VDATA1)
*		@ 08,40 SAY SPACE(33)*
*		@ 08,50 SAY "Calendario "
		@ 09,39 CLEAR TO 17,73
		@ 08,39 TO 17,74 DOUBLE
		@ 09,50 SAY VNOMEMES+" /"+STR(YEAR(VDATA1))
		@ 10,40 SAY "DOM  SEG  TER  QUA  QUI  SEX  SAB"	
		
		X=0	
*		@ 05,21 TO 07,57								
		SET MESSAGE TO 22 CENTER
*		@ 06,41 SAY VNOMEMES+" DE "+STR(YEAR(VDATA1))
		DO WHILE MONTH(VDATA2)=MONTH(VDATA1)
			@ VLINHA,VPOS PROMPT  DIA MESSAGE DIASEM(VDATA1+X)+" dia "+DIA+SPACE(2)+VNOMEMES+" DE "+STR(YEAR(VDATA1))
			DIA=ALLTRIM(STR(VAL(DIA)+1))
			VDATA2=VDATA2+1
			VPOS=VPOS+5
			X=X+1
			IF VPOS>70
				VPOS=40
				VLINHA=VLINHA+1
	 		ENDIF
		ENDDO
		MENU TO VOPCAO
		DO CASE
		
			CASE LASTKEY()=27
				EXIT
	
			CASE LASTKEY()=3
				VDATA1=VDATA1+35
	
			CASE LASTKEY()=18
				VDATA1=VDATA1-28
	
		ENDCASE
	
		VDATA1=CTOD("01"+SUBSTR(DTOC(VDATA1),3,8))
		VDATA_FINAL =CTOD(STRZERO(VOPCAO,2)+SUBSTR(DTOC(VDATA1),3,8))
ENDDO
IF LASTKEY() = 27
	VDATA_FINAL = DATE()
ENDIF
RESTORE SCREEN FROM VTELACALE
SET MESSAGE TO 03 CENTER
SET COLOR TO &AS
SET CURSOR ON
SET KEY -9 TO HORA	
SET KEY -8 TO CALENDARIO
RETURN
SET CURSO OFF	
SET MESSAGE TO 03 CENTER
**************
FUNCTION MES
**************
VDATA=DATE()
PARAMETERS VDATA

DO CASE
	CASE MONTH(VDATA)=1
		VMES="Janeiro"
	CASE MONTH(VDATA)=2
		VMES="Fevereiro"
	CASE MONTH(VDATA)=3
		VMES="Mar‡o"
	CASE MONTH(VDATA)=4
		VMES="Abril"
	CASE MONTH(VDATA)=5
		VMES="Maio"
	CASE MONTH(VDATA)=6
		VMES="Junho"
	CASE MONTH(VDATA)=7
		VMES="Julho"
	CASE MONTH(VDATA)=8
		VMES="Agosto"
	CASE MONTH(VDATA)=9
		VMES="Setembro"
	CASE MONTH(VDATA)=10
		VMES="Outubro"
	CASE MONTH(VDATA)=11
		VMES="Novembro"
	CASE MONTH(VDATA)=12
		VMES="Dezembro"
ENDCASE			

RETURN VMES

VDIA1=CTOD("01"+SUBSTR(DTOC(VDATA),3,6))

FUNCTION POS
PARAMETERS VDATA

DO CASE

	CASE DOW(VDATA)=1
		VVPOS=40
	CASE DOW(VDATA)=2
		VVPOS=45
	CASE DOW(VDATA)=3
		VVPOS=50
	CASE DOW(VDATA)=4
		VVPOS=55
	CASE DOW(VDATA)=5
		VVPOS=60
	CASE DOW(VDATA)=6
		VVPOS=65
	CASE DOW(VDATA)=7
		VVPOS=70
		
ENDCASE

RETURN VVPOS
	

RETURN VMES	

PROCEDURE ASPR1424
**************************************************
*                                                *
* ASPR1421.PRG - ALTERACAO DE CODIGO USUARIO     *
*                                                *
**************************************************

PRIVATE VTELA,VREP,VOK
SAVE SCREEN TO VTELA

TITULO(VNOMESIS,"ALTERA€AO DE CODIGO USUARIO")
RODAPE(VTECBASN,.F.)

SET COLOR TO &VCTEXT
VREP=.T.
VCODIGO=SPACE(4)
VMATRICULA=SPACE(7)
VCLASSE=SPACE(2)

DO WHILE LASTKEY()# 27 .OR. VREP
	
	VOK=.F.
   VREP=.F. 
	VATU=.T.
	
	
	IF VOK
	
		VCODIGO1=VCODIGO
		VMAT1=VMATRICULA
		VCLASSE1=VCLASSE
		
		SET CURSOR ON
				
		@ 15,10 SAY "Digite o NOVO codigo:"

		@ 17,10 SAY "EMPRESA:" GET VCODIGO1 PICTURE "9999" VALID TESTACOD(VCODIGO1,'EMPRESAS',.T.,.F.)
		@ 17,33 SAY "MATRICULA:" GET VMAT1 PICTURE "9999999" VALID .NOT. EMPTY(VMATRICULA1)
		@ 17,61 SAY "CLASSE:" GET VCLASSE1 PICTURE "99" VALID VCLASSE1>="00" .AND. VCLASSE1<="99"
		@ 19,05 SAY "ATENCAO.: Muito cuidado ao efetuar esta alteracao, certifique-se antes se"
      @ 20,05 SAY "          o novo codigo nao esta cadastrado ou se existem dependentes."

		READ		

		IF LASTKEY()#27
		
			SELE USUARIOS
			
			SEEK VCODIGO1+VMAT1+VCLASSE1
			
			IF EOF()			

				GO TOP
				
				SEEK VCODIGO+VMATRICULA+VCLASSE
				REPLACE CODEMP WITH VCODIGO1,MATRICULA WITH VMAT1,CLASSE WITH VCLASSE1
		
				IF VCODIGO>="7777" .AND. VCODIGO<="8888"

					SELE ENDIFIS
					GO TOP
					SEEK VCODIGO+VMATRICULA
					IF .NOT. EOF()
						REPLACE MATRICULA WITH VCODIGO1+VMAT1
					ENDIF
				ENDIF

				SAVE SCREEN
   	      ENVMSG("O usuario "+VCODIGO1+"-"+VMATRICULA1+"-"+VCLASSE1+" foi alterado","",.F.,.F.,.F.,.T.)
				DO ESPERA
		   	RESTORE SCREEN
				               
	      ELSE
	
		      SAVE SCREEN
			   ENVMSG("Cancelada a altera‡ao do usuario "+VCODIGO+"-"+VMATRICULA+"-"+VCLASSE+", codigo ja existe","",.F.,.F.,.F.,.T.)
				DO ESPERA 
			   RESTORE SCREEN
			   VREP=.T.
		
	   	ENDIF

		ENDIF
	
	ENDIF
	
ENDDO

DO AGUARDE
CLOSE DATABASES

SET COLOR TO &VCMENU
RESTORE SCREEN FROM VTELA

RETURN

PROCEDURE SENHA1

*****************************************
*                                       *
* ASPRSENHA - CADASTRO USUARIOS         *
*                                       *
*****************************************

PRIVATE VTELA,VOPCAO,VOPCOES[4],VMSG[4]

RESTORE SCREEN
SAVE SCREEN TO VTELA 

RODAPE(VTECBAS,.F.)

VOPCOES[1] = "Inclusao"
VOPCOES[2] = "Alteracao"
VOPCOES[3] = "Exclusao"
VOPCOES[4] = "Relatorio"

VMSG[1] = "Inclusao de novos usuarios no sistema"
VMSG[2] = "Alteracao de dados/acessos dos usuarios"
VMSG[3] = "Exclusao de usuarios no sistema"
VMSG[4] = "Relacao de usuarios alfa/nume."

DO WHILE .T.

	VHELP = "ASPR1"	
	VOPCAO = SUBMENU (4,VOPCOES,VMSG,8,11,.T.)
	VHELP = ""
   SAVE SCREEN
	
	DO CASE
		CASE VOPCAO = 0
			EXIT
	
      CASE VOPCAO = 1
*			DO SENHA2

      CASE VOPCAO = 2
*         DO SENHA3
			
      CASE VOPCAO = 3
*         DO SENHA4

      CASE VOPCAO = 4
 *        DO SENHA5

   ENDCASE

ENDDO

RESTORE SCREEN FROM VTELA

RETURN

PROCEDURE SENHA2

*******************************************
* OPOSTO DA CRIPTA
*******************************************
FUNCTION OPOSTO
PARAMETERS VOPOSTO

X=1
VVR=""
DO WHILE X<=LEN(VOPOSTO)

	VV=ASC(SUBS(VOPOSTO,X,1))-128
	IF VV>78
		VV=155-VV
	ELSE
		VV=VV+13
	ENDIF
	X=X+1
	VVR=VVR+CHR(VV)
ENDDO

RETURN VVR

*********************************
FUNCTION ACESIST
*********************************
PARAMETERS POSICAO

SAVE SCREEN TO VTELA5

IF SUBSTR(VACESIST,POSICAO,1)="X"
	VRETSIS=.T.
ELSE
	SAVE SCREEN
   ENVMSG("VOCE NAO ESTA AUTORIZADO A EXECUTAR ESTA OPCAO","",.F.,.F.,.F.,.T.)
	DO ESPERA
	RESTORE SCREEN	
	VRETSIS=.F.
ENDIF
RETURN VRETSIS

FUNCTION MESANTES
PARAMETERS VMESATUAL,VMESMENOR

VMESX1=SUBSTR(VMESATUAL,3,2)
VANOX1=SUBSTR(VMESATUAL,1,2)

IF VMESX1="01"
	VMESX1=STRZERO((13-VMESMENOR),2)
	VANOX1=STRZERO(VAL(VANOX1)-1,2)
ELSE
	VMESX1=STRZERO(VAL(VMESX1)-VMESMENOR,2)
ENDIF

RETURN VANOX1+VMESX1

FUNCTION VDESCR

PARAMETERS VPLANO

DO CASE

	CASE VPLANO="PR040"
		VRESP="VDES27"
	CASE VPLANO="PR041"
		VRESP="VDES28"	
	CASE VPLANO="PR042"
		VRESP="VDES29"	
	CASE VPLANO="PR043"	
		VRESP="VDES30"
	CASE VPLANO="PR044"
		VRESP="VDES31"
		
	CASE VPLANO="PR050"
		VRESP="VDES32"
	CASE VPLANO="PR051"
		VRESP="VDES33"	
	CASE VPLANO="PR052"
		VRESP="VDES34"	
	CASE VPLANO="PR053"	
		VRESP="VDES35"	
	CASE VPLANO="PR054"
		VRESP="VDES36"		
		
	CASE VPLANO="PR070"
		VRESP="VDES39"
	CASE VPLANO="PR071"
		VRESP="VDES37"	
	CASE VPLANO="PR072"
		VRESP="VDES38"	

	OTHERWISE
	
		VRESP="VDES1 "
		
ENDCASE
		
RETURN VRESP

**************************		
FUNCTION ACHABOLETA
**************************
PARAMETERS VCODEMP,VMATRICULA,VMESANO

VARQANTES=DBF()

SELE PRESTFIS
GO TOP

SEEK VCODEMP+VMATRICULA

VSAI=.F.
VREG=0

DO WHILE VCODEMP+VMATRICULA=CODEMP+MATRICULA .AND..NOT. EOF() .AND. .NOT. VSAI

	IF .NOT. DELE() .AND. VMESANO=MESANO
		VSAI=.T.
		VREG=RECNO()
	ENDIF
	
	SKIP
	
ENDDO

SELE &VARQANTES

RETURN VREG


FUNCTION MSGBOLETA
PARAMETERS VTIPOMSG
DO CASE

	CASE VTIPOMSG=1
		MSG="PRESTACAO JA EMITIDA, UTILIZE REBLOQUETE"
	CASE VTIPOMSG=2
		MSG="NAO EXISTE PRESTACAO PARA O USUARIO"
	CASE VTIPOMSG=3
		MSG="A 1 PRESTACAO DO USUARIO E PARA "
		
ENDCASE

RETURN .T.

*****************************
	PROCEDURE USUAGENDA
*****************************
	PARAMETERS VPROG,VLIN,VGET

	PRIVATE VCOLOR,VTELA,VCAMPOS[3],VCABEC[3],VLIN,VCOL,VARQ

	VLIN = ROW()
	VCOL = COL()
	VARQ = ALIAS()
	
*	SET KEY -2 TO 
	SET KEY 24 TO
	SET KEY 5  TO
	SET KEY -3 TO
	
	SAVE SCREEN TO VTELA
	VCOLOR = SETCOLOR()

	RODAPE(CHR(24)+CHR(25)+CHR(26)+CHR(27)+" examina  ENTER escolhe codigo  ESC desiste",.F.)

	SET COLOR TO &VCDBED
	
	@ 05,10 CLEAR TO 19,75
	@ 04,09 TO 16,77 DOUBLE
	@ 17,10 TO 19,76 DOUBLE
	@ 18,11 SAY "TECLE <F3> PARA PESQUISA ESPECIFICA                   "
	VCABEC[1] = "CODIDO USUARIO"
	VCABEC[2] = "NOME"
	VCABEC[3] = "DT.NASCI"
	
	VCAMPOS[1] = "CODEMP+'-'+MATRICULA+'/'+CLASSE"
	VCAMPOS[2] = "NOME"
	VCAMPOS[3] = "DTNASCI"

	VARQ=ALIAS()

	SELECT USUARIOS
	SET ORDER TO 2
	GO TOP

	DBEDIT(05,10,15,76,VCAMPOS,"FDBEDIT",0,VCABEC)

	SET KEY -2 TO 
	
	IF LASTKEY() # 27
		get_data = CODEMP+MATRICULA+CLASSE
		VCODEMP=CODEMP
		VMATRICULA=MATRICULA
		VCLASSE=CLASSE
		KEYBOARD CHR(13)
		VUPD = .T.
	ENDIF

	@ VLIN,VCOL
	SETCOLOR(VCOLOR)
	RESTORE SCREEN FROM VTELA
	SET ORDER TO 1

	SELECT &VARQ

RETURN 

**************
FUNCTION TEMPO
**************

PARAMETERS VINICIO

HORA=SUBS(VINICIO,1,2)
MIN=SUBS(VINICIO,4,2)
SEG=SUBS(VINICIO,7,2)
VREAL=(VAL(SEG)+(VAL(MIN)*60))+((VAL(HORA)*60)*60)
RETURN VREAL

****************
FUNCTION VTEMPO1
****************
PARAMETERS VOP

DO CASE 
	CASE VOP="1"
		VTP="UMA HORA"
	CASE VOP="2"
		VTP="MEIA HORA"
	CASE VOP="3"
	   VTP="20 MINUTOS"
	CASE VOP="4"
		VTP="15 MINUTOS"
	CASE VOP="5"
		VTP="10 MINUTOS"
	OTHERWISE
		VTP="NAO EXISTE"
ENDCASE
RETURN VTP

*****************
FUNCTION TEMPOINV
*****************
PARAMETERS VOP,VHORA

DO CASE
	CASE VOP="1"
		VSEG=3600 
	CASE VOP="2"
		VSEG=1800
	CASE VOP="3"
		VSEG=1200
	CASE VOP="4"
		VSEG=900
	CASE VOP="5"
		VSEG=600
	CASE VOP="6"
		VSEG=5400
	OTHERWISE
		VSEG=0
ENDCASE

VHORAC=TEMPO(VHORA)
VHORAC=VHORAC+VSEG
VSEG=(VHORAC/60)-INT(VHORAC/60)
VMIN=(VHORAC/60/60)-INT(VHORAC/60/60)
VHORA=INT(VHORAC/60/60)

VRET=TSTRING(VHORAC)

RETURN VRET

*****************************************
*                                       *
* ASPR999.PRG - ENCERRA O PROCESSAMENTO *
*                                       *
*****************************************
	
PROCEDURE ASPR999
SAVE SCREEN TO VTELA1
VCOR=SETCOLOR()
SET COLOR TO 
SET CURSOR ON
@ 24,01 SAY "Deseja Sair.: "
@ 24,15 PROMPT " SIM " 
@ 24,21 PROMPT " NAO "
MENU TO VRES
IF VRES=1
	SET CURSO OFF
	SET COLOR TO 
	X=0
	CLEAR
	SWPRUNCMD("MODE CO40",0,"","")
	CENTRA(05,00,38,"Voce Ja Pode Desligar O Seu")
	CENTRA(06,00,38,"Computador Com Seguranca")
	CENTRA(07,00,38,"Obigando !")
	USE CONFIG
	GO TOP
	VNADA="S"
	REPLACE FIM WITH VNADA
	DO WHILE .T.
		PAUSE(0)
		IF INKEY()=0
			EXIT
		ENDIF
	ENDDO
	SET COLOR TO W/N	

	SWPRUNCMD("MODE CO80",0,"","")
	SET CURSO ON
	QUIT
ENDIF
SET COLOR TO &VCOR
RESTORE SCREEN FROM VTELA1
RETURN
******************
PROCEDURE INDEGERA
******************

SAVE SCREEN TO VTELA
SET CURSO OFF
@ 05,05 CLEAR TO 20,77
IF VINDE="1" .OR. VINDE="T"
	ENVMSG("Reorganizando arquivo de CLIENTES","",.F.,.F.,.F.,.T.)
	USE CLIENTE
	INDEX ON CODCLI TO CLIENTEA
	INDEX ON NOME TO CLIENTEB
ENDIF

IF VINDE="2" .OR. VINDE="T"
	ENVMSG("Reorganizando arquivo de PRODUTOS","",.F.,.F.,.F.,.T.)
	USE PRODUTO
	INDEX ON CODPROD TO PRODUTOA
	INDEX ON DESCRICAO TO PRODUTOB
ENDIF

IF VINDE="3" .OR. VINDE="T"
	ENVMSG("Reorganizando arquivo de CLASSES","",.F.,.F.,.F.,.T.)
	USE CLASSE
	INDEX ON CLASSE TO CLASSEA
	INDEX ON DESCRICAO TO CLASSEB
	
	ENVMSG("Reorganizando arquivo de TIPOS","",.F.,.F.,.F.,.T.)
	USE TIPO
	INDEX ON TIPO TO TIPOA
	INDEX ON DESCRICAO TO TIPOB
ENDIF

IF VINDE="4" .OR. VINDE="T"
	ENVMSG("Reorganizando arquivo de LOCACOES","",.F.,.F.,.F.,.T.)
	USE LOCACAO
	INDEX ON CODIGO TO LOCACAOA
	INDEX ON LANCAMENTO TO LOCACAOB
	INDEX ON NOME TO LOCACAOD
	INDEX ON DTPAGO TO LOCACAOC
	USE LOCACAO2
	INDEX ON LANCAMENTO TO LOCAA
	INDEX ON CLIENTE+PRODUTO TO LOCAB
	INDEX ON PRODUTO TO LOCAC
	INDEX ON CLIENTE TO LOCADA
	USE LOCATOT
	INDEX ON DTLOC TO LOCATOTA
	INDEX ON LANCAMENTO TO LOCATOTB
	INDEX ON DTPAGO TO LOCATOTC
	USE EXPLICA
	INDEX ON LANCAMENTO TO EXPLIA
ENDIF

IF VINDE="T" 
	USE USUARIO
	INDEX ON CODIGO TO USUARIOA
	INDEX ON NOME TO USUARIOB
ENDIF

CLOSE DATABASES
SET CURSO ON
RESTORE SCREEN FROM VTELA

RETURN

FUNCTION ACHALETRA9						&& pula para letra

	PARAMETERS VMODO,VCAMPO
	PRIVATE VRET
	
	IF VMODO=4 .AND. LASTKEY()>31 .AND. LASTKEY()<128
		
		SET SOFTSEEK ON
		SEEK UPPER(CHR(LASTKEY()))
		SET SOFTSEEK OFF
		
		VRET = 2
		
	ELSE
	
		IF  LASTKEY()=13 
			
			VRET = 0
				
		ELSE
			
			VRET = 1
			
		ENDIF
		
	ENDIF
	
	RETURN VRET
	
****************	
FUNCTION TESTCOD
****************

PARAMETERS VCODIGO

SELE PRODUTO
GO TOP
SEEK VCODIGO
IF EOF()
	ENVMSG("Codigo de produto nao cadastrado","",.F.,.F.,.F.,.T.)
	VRET=.F.
ELSE
	VDESCRICAO[X]=DESCRICAO
	VCLASSE=CLASSE
	SELE CLASSES
	GO TOP
	SEEK VCLASSE
	IF EOF()
		VVALOR[X]=0
		VDIAS[X]=0
	ELSE
		VVALOR[X]=VALOR
		VDIAS[X]=DIAS
		VRET=.T.
	ENDIF

ENDIF
	
	RETURN VRET
	

	


PROCEDURE STELA
SAVE SCREEN TO VTELA
PROCEDURE RTELA
RESTORE SCREEN FROM VTELA
RETURN
FUNCTION CLEBER12							&& codifica a senha

	PARAMETERS VPW
	PRIVATE VCONT,VCPW,VNL

	VCONT = 1
	VCPW  = ""

	DO WHILE VCONT <= LEN(VPW)

		VNL = ASC(SUBSTR(VPW,VCONT,1))
	
		VNL = IIF(VNL<78, 155-VNL, VNL-13)
		VNL = VNL + 128
		
		VCPW = VCPW + CHR(VNL)

		VCONT = VCONT+1
	
	ENDDO

	RETURN VCPW

*** fim da fun‡ao CRIPTA
PROCEDURE ASHELP
SAVE SCREEN TO VTELA
*SET COLOR TO W+/W+
@ 05,02 CLEAR TO 20,77
@ 06,06 SAY "             MENU <TRABANHO>"
@ 07,06 SAY "PARA VOCE FAZER LOCACAO DEVOLUCAO "
@ 08,06 SAY "PARA VOCE FECHA CAIXA E INICIAO DE JOGO"
@ 09,06 SAY "PARA FIMALIZAR O JOGO"
@ 10,06 SAY "             MENU <CADASTRO>"
@ 11,06 SAY "PARA VOCE CADASTRA CLIENTE,PRODUTO,CLASSE,TIPO,E USUARIO"
@ 12,06 SAY "             MENU <PESQUISA>"
@ 13,06 SAY "PARA VOCE PESQUISA CLIENTE,ULTUMA LOCACAO,CLIENTE EM ATRASO"
@ 14,06 SAY "PRODUTO POR NOME,FILME POR ATOR"
@ 15,06 SAY "             MENU <RELATRORIO>"
@ 16,06 SAY "PARA IMPRESAO DE RELATROREO " 
@ 17,06 SAY "             MENU <APOIO>"
@ 19,06 SAY "PARA SALVA OS AQUIVO, RESTARA OS ARQUIVO,REOGAMIZA OS AQUIVO"
INKEY(0)
RESTORE SCREEN FROM VTELA
RETURN
PROCEDURE SVL
SAVE SCREEN TO VTELA
RUN CD\SVL
RUN SVL
RESTORE SCREEN FROM VTELA
RETURN

*******************
FUNCTION MOSP
*******************
PARAMETERS VCHAVE

VARQ=ALIAS()

SELE PRODUTO

PRIVATE VCOLOR,VTELA,VCAMPOS[4],VCABEC[4],VLIN,VCOL,VRET

VLIN = ROW()
VCOL = COL()
	
SAVE SCREEN TO VTELA
VCOLOR = SETCOLOR()

RODAPE(CHR(24)+CHR(25)+CHR(26)+CHR(27)+" examina  ENTER escolhe Produto  ESC desiste",.F.)

SET COLOR TO &VCDBED
@ 10,28 CLEAR TO 10,75
@ 10,29 TO 20,29 DOUBLE
@ 10,76 TO 20,76 DOUBLE

VCABEC[1] = "DESCRICAO"
VCABEC[2] = "CODIGO"
VCABEC[3] = "ATORES"
	
VCAMPOS[1] = "DESCRICAO"
VCAMPOS[2] = "CODPROD"
VCAMPOS[3] = "ATORES" 

SEEK VCODIGO
	
IF .NOT. EOF()
	VCODPROD = CODPROD
ELSE
	VCODPROD = ""
ENDIF
	
SET ORDER TO 2
	
IF EMPTY(VCODPROD)
	GOTO TOP
ELSE
	SEEK VCODPROD
ENDIF
	
DBEDIT(10,25,20,75,VCAMPOS,"ACHALETRA",0,VCABEC)

IF LASTKEY() # 27
	VCODPROD = CODPROD

	KEYBOARD CHR(13)		
ELSE
	VRET = ""
	KEYBOARD CHR(13)
	VUPD = .T.
ENDIF
	
SET ORDER TO 1

@ VLIN,VCOL
SETCOLOR(VCOLOR)
RESTORE SCREEN FROM VTELA

SELE &VARQ

RETURN VCODPROD
PROCEDURE CRIA
SAVE SCREEN TO VTELA
Z=SETCOLOR()
SET COLOR TO B/R
@ 10,20 CLEAR TO 13,50
SET COLOR TO W/B
@ 10,20 SAY SPACE(31)
@ 10,22 SAY X
SET COLOR TO B/W
@ 12,23 SAY SPACE(25)
SET COLOR TO B/R
X=23
REINDEX
DO WHILE .T.
@ 12,X SAY CHR(219)
IF X=48
	EXIT
ENDIF
INKEY(0.3)
X=X+1
ENDDO
RESTORE SCREEN FROM VTELA
SET COLOR TO &Z
PROCEDURE AJUDA
I=SETCOLOR()
	SAVE SCREEN TO VTELAAJUDA
		SET COLOR TO W/G
		@ 04,00 CLEAR TO 11,25 
		@ 04,00 TO 11,25 
		SET COLOR TO I/G
		@ 05,25 TO 11,25
		@ 11,01 TO 11,25
		@ 04,25 SAY CHR(191)
		@ 11,25 SAY CHR(217)
		@ 11,00 SAY CHR(192)
		OY=SETCOLOR()
		SOBRA1(04,00,12,25,"W+/G","I/G")
		SET COLOR TO GR+/G
		@ 05,01 SAY "--- Teclas de atalho ---" 
		@ 07,01 SAY "F1 Teclas"
		@ 08,15 SAY "F2 Sair  "
		@ 09,01 SAY "F3 Calendario"
		@ 10,15 SAY "F4 Hora"
		@ 11,01 SAY "F5 Datas"
		INKEY(0)
		IF LASTKEY()=-1
	*	ELSEIF LASTKEY()=-2
*			DO CALENDARIO
*		ELSEIF LASTKEY()=-3
*			DO HORA
		ENDIF
		SET COLOR TO B/BG+
*SET CURSO ON
SET COLOR TO &I
RESTORE SCREEN FROM VTELAAJUDA
RETURN
*****************************************************
FUNCTION FDISK	&& Posiciona o Curso em cima do indice
*****************************************************
PARAMETERS ARQ,INDICE,CHAVE,COLOR,ERRO
VRET=.T.
VCOR=SETCOLOR()
VARQ=ALIAS()
USE &ARQ INDEX &INDICE
GO RECNO()
SEEK CHAVE 
J=LEN(ERRO)+10
IF EOF()
SAVE SCREEN TO VTELAERRO
SET COLOR TO &COLOR
		P=LEN(ERRO)
		PP=80 - P
		TOTAL=PP/2
		*SET COLOR TO W/G
		*@ 09,09 TO 11,J
		*SET COLOR TO I/G
		*@ 11,10 TO 11,J
		*@ 10,J SAY CHR(179)
		*@ 11,J SAY CHR(217)
		@ 00,00 SAY SPACE(80)
		@ 00,TOTAL SAY ERRO
		INKEY(0)
SET COLOR TO &COR
RESTORE SCREEN FROM VTELAERRO
ELSE	
		VRET=.T.
ENDIF	
RETURN VRET
SELE &VARQ

***************
FUNCTION SENHA 
***************
PARAMETERS VCOL,VLIN,MOSTRA,SPACE

*SAVE SCREEN TO VTELAY
PUBLIC td
X=ROW()
Y=VLIN
DESL=0
TAM=0
VCHR=1
TD=""  
I=SETCOLOR()
SET COLOR TO I/W
@ VCOL,VLIN+1 SAY SPACE(SPACE)
SET COLOR TO I/W
@ VCOL,VLIN+1 SAY ""
DO WHILE .T.
     A=INKEY(0)
        IF A=8 .OR. A=19
               IF TAM>0
                    DESL=DESL - 1
                    TAM = TAM - 1
                    TD = LEFT(TD,TAM)
                    @ VCOL,Y+DESL+1 SAY  SPACE(1)
                    TAM=LEN(TD)
                    VCHR=VCHR-1
                    LOOP
                 ENDIF
           ENDIF
           IF LAST()=13 .OR. LAST()=27
                EXIT
	        ENDIF
		
	DESL=DESL+1
	TD=TD+CHR(A)
   @ VCOL,Y+DESL SAY CHR(MOSTRA)
   TAM=LEN(TD)
   X=X+1
   VCHR=VCHR+1
ENDDO
SET COLOR TO &I
VSENHA=TD
*RESTORE SCREEN FROM TELAY
*RETURN
**************
FUNCTION SOBRA1
**************
PARAMETERS VCOLI,VLINI,VCOLF, VLINF,VCOR1,VCOR2
P=SETCOLOR() 
SET COLOR TO &VCOR1
@ VCOLI,VLINI CLEAR TO VCOLF,VLINF
@ VCOLI,VLINI TO VCOLF,VLINF DOUBLE
SET COLOR TO &VCOR2
@ VCOLF,VLINI+1 TO VCOLF,VLINF DOUBLE
@ VCOLI,VLINF TO VCOLF,VLINF DOUBLE
@ VCOLF,VLINF SAY CHR(217)
@ VCOLI,VLINF SAY CHR(187)
@ VCOLF,VLINI SAY CHR(200)
@ VCOLF,VLINF SAY CHR(188)

RETURN .T.
SET COLOR TO &P
PROCEDURE SP
IF LEN(TD)=1
	TD=TD+SPACE(9)
ELSEIF LEN(TD)=2
	TD=TD+SPACE(8)
ELSEIF LEN(TD)=3
	TD=TD+SPACE(7)
ELSEIF LEN(TD)=4
	TD=TD+SPACE(6)
ELSEIF LEN(TD)=5
	TD=TD+SPACE(5)
ELSEIF LEN(TD)=6
	TD=TD+SPACE(4)
ELSEIF LEN(TD)=7
	TD=TD+SPACE(3)
ELSEIF LEN(TD)=8
	TD=TD+SPACE(2)
ELSEIF LEN(TD)=9
	TD=TD+SPACE(1)
ENDIF
PROCEDURE SE
VSENHAP=SENHA
IF LEN(VSENHAP)=1
        VSENHAP=VSENHAP+SPACE(9)
ELSEIF LEN(VSENHAP)=2
        VSENHAP=VSENHAP+SPACE(8)
ELSEIF LEN(VSENHAP)=3
        VSENHAP=VSENHAP+SPACE(7)
ELSEIF LEN(VSENHAP)=4
        VSENHAP=VSENHAP+SPACE(6)
ELSEIF LEN(VSENHAP)=5
        VSENHAP=VSENHAP+SPACE(5)
ELSEIF LEN(VSENHAP)=6
        VSENHAP=VSENHAP+SPACE(4)
ELSEIF LEN(VSENHAP)=7
        VSENHAP=VSENHAP+SPACE(3)
ELSEIF LEN(VSENHAP)=8
        VSENHAP=VSENHAP+SPACE(2)
ELSEIF LEN(VSENHAP)=9
        VSENHAP=VSENHAP+SPACE(1)
ENDIF
VS=VSENHAP
**************
FUNCTION SOBRA
**************
PARAMETERS VCOLI,VLINI,VCOLF, VLINF,VCOR1,VCOR2
P=SETCOLOR() 
SET COLOR TO &VCOR1
@ VCOLI,VLINI CLEAR TO VCOLF,VLINF
@ VCOLI,VLINI TO VCOLF,VLINF 
SET COLOR TO &VCOR2
@ VCOLF,VLINI+1 TO VCOLF,VLINF
@ VCOLI,VLINF TO VCOLF,VLINF
@ VCOLF,VLINF SAY CHR(217)
@ VCOLI,VLINF SAY CHR(191)
*@ VCOLF,VLINI SAY CHR(192)
SET COLOR TO &P
RETURN .T.
SET COLOR TO &P
**************
PROCEDURE CALE
**************
SAVE SCREEN TO VTELACAL
P=SETCOLOR()
SET CURSO ON
DO WHILE LAST()#27	
	SOBRA(10,20,12,50,"W+/G","I/G")
	DATE=DATE()
	SET COLOR TO GR/G
	@ 11,21 SAY "Data "GET DATE
	READ
	IF LAST()#27
		@ 11,38 SAY DIASEM(DATE)
		INKEY(0)

	ENDIF
ENDDO
SET COLOR TO &P
RESTORE SCREEN FROM VTELACAL
RETURN
SET COLOR TO &P
*************
PROCEDURE CAL
*************
SAVE SCREEN TO VTELACAL
COLOR=SETCOLOR()
DO WHILE LAST()#27
PRIVATE VCAL[10]
SOBRA1(06,15,23,50,"W/G","I/G")
SOBRA(07,16,10,49,"I/G","W/G")
DO NUMERO
CL=SETCOLOR()
SET COLOR TO I/W
SET CURSO ON
VCA1=0
VCA2=0
VR=SPACE(1)

@ 08,17 SAY SPACE(32)
@ 09,17 SAY SPACE(32)
@ 09,27 GET VCA1 PICT  "9999999999999999.99"
@ 09,48 GET VR VALID VR$"+-*/" 
P=VR

READ
IF LAST()#27
   IF VR$"/*-+"
      ARIT	= VR
      ARIT_DISP =IIF(ARIT="/","ö",IIF(ARIT="*","X",IIF(ARIT="+","+","-")))
   ENDIF

@ 09,17 SAY SPACE(32)
@ 08,24 SAY VCA1 PICT  "9999999999.99"
@ 08,38 SAY  ARIT_DISP 
@ 09,35 GET VCA2 PICT  "99999999999.99"	
READ
ENDIF
@ 08,17 SAY SPACE(32)
@ 09,17 SAY SPACE(32)
@ 08,20 SAY VCA1 PICT "9999999.99"
@ 08,38 SAY VCA2 PICT "9999999.99"
@ 09,17 SAY "="

VT=.F.
IF VR="/"
VT=.T.
	TOTAL=VCA1/VCA2
	VR="ö"
ELSEIF VR="*"
VT=.T.
	TOTAL=VCA1*VCA2
	VR="X"
ELSEIF VR="+"
VT=.T.
	TOTAL=VCA1+VCA2
VR="+"
ELSEIF VR="-"
VT=.T.
VR="-"
	TOTAL=VCA1+VCA2		
ENDIF
IF VR=" "
VT=.T.
	TOTAL="***********"
ENDIF
IF LAST()#27 
	@ 09,18 SAY TOTAL PICT "999999999999999999999999999999"
	@ 08,32 SAY VR
	INKEY(0)
ENDIF	
ENDDO
SET COLOR TO &COLOR
RESTORE SCREEN FROM VTELACAL
RETURN

PROCEDURE NUMERO
COR=SETCOLOR()
SOBRA(11,17,13,21,"W+/G","I/G")
@ 12,19 SAY "1"
SOBRA(11,25,13,29,"W+/G","I/G")
@ 12,27 SAY "2"
SOBRA(11,33,13,37,"W+/G","I/G")
@ 12,35 SAY "3"
SOBRA(14,17,16,21,"W+/G","I/G")
@ 15,19 SAY "4"
SOBRA(14,25,16,29,"W+/G","I/G")
@ 15,27 SAY "5"
SOBRA(14,33,16,37,"W+/G","I/G")
@ 15,35 SAY "6"
SOBRA(17,17,19,21,"W+/G","I/G")
@ 18,19 SAY "7"
SOBRA(17,25,19,29,"W+/G","I/G")
@ 18,27 SAY "8"
SOBRA(17,33,19,37,"W+/G","I/G")
@ 18,35 SAY "9"
SOBRA(20,17,22,21,"W+/G","I/G")
SET COLOR TO R/G
@ 21,19 SAY "-"
SOBRA(20,25,22,29,"W+/G","I/G")
@ 21,27 SAY "0"
SOBRA(20,33,22,37,"W+/G","I/G")
SET COLOR TO R/G
@ 21,35 SAY "+"
SOBRA(11,41,13,45,"W+/G","I/G")
SET COLOR TO R/G
@ 12,43 SAY "ö"
SOBRA(14,41,16,45,"W+/G","I/G")
SET COLOR TO R/G
@ 15,43 SAY "X"
SOBRA(18,41,22,45,"W+/G","I/G")
SET COLOR TO R/G
@ 20,43 SAY "="
**************
FUNCTION SOBRAL
**************
PARAMETERS VCOLI,VLINI,VCOLF, VLINF,VCOR1,VCOR2
P=SETCOLOR() 
SET COLOR TO &VCOR1
*@ VCOLI,VLINI CLEAR TO VCOLF,VLINF
@ VCOLI,VLINI TO VCOLF,VLINF 
SET COLOR TO &VCOR2
@ VCOLF,VLINI+1 TO VCOLF,VLINF
@ VCOLI,VLINF TO VCOLF,VLINF
@ VCOLF,VLINF SAY CHR(217)
@ VCOLI,VLINF SAY CHR(191)
*@ VCOLF,VLINI SAY CHR(192)
SET COLOR TO &P
RETURN .T.
SET COLOR TO &P

*****************
 PROCEDURE INDEX 
*****************
SAVE SCREEN TO VTELAINDEX
@ 11,30 CLEAR TO 15,50 
@ 11,30 TO 15,50 DOUBLE

CENTRA(12,25,55,"Criado Estrututa")
@ 13,31 TO 13,49 DOUBLE
@ 13,30 SAY "Ì"
@ 13,50 SAY "¹"
X=31
SET CURSO OFF
IF VINDEX = "T"
	USE CLIENTE INDEX CLIENTE1 INDEX CLIENTE2	
	PACK
	USE PRODUTO INDEX PRODUTO1 INDEX PRODUTO2
	PACK
	VCOR=SETCOLOR()
	SET COLOR TO W/W
	@ 14,31 SAY SPACE(19)
	SET COLOR TO GR+/N

	DO WHILE .T.
		@ 14,X SAY "Û"
		X=X+1
		IF X=49
			EXIT
		ENDIF
		INKEY(0.4)
	ENDDO
	INKEY(0.4)
	SET COLOR TO &VCOR
	@ 14,31 SAY SPACE(19)
ENDIF
CENTRA(12,25,55,"  A g u a r d e  ")
CENTRA(14,25,55,"  0%")
INKEY(0.8)

IF VINDEX = "1" .OR. VINDEX = "T"
   	USE SENHA		
		CENTRA(14,25,55,"  5%")
	   INDEX ON NOME TO SENHA
		USE CLIENTE
		CENTRA(14,25,55," 20%")
		INDEX ON PLACA TO CLIENTE1
		CENTRA(14,25,55," 25%")
		INDEX ON NOME TO CLIENTE2
		CENTRA(14,25,55," 40%")
ENDIF
IF VINDEX = "2" .OR. VINDEX = "T"
	USE PRODUTO
		CENTRA(14,25,55," 50%")
		INDEX ON CODP TO PRODUTO1
		CENTRA(14,25,55," 65%")
		INDEX ON DESCRICAO TO PRODUTO2
		CENTRA(14,25,55," 75%")
ENDIF
IF VINDEX = "3" .OR. VINDEX = "T"
	USE VENDAS
	CENTRA(14,25,55," 85%")
	INDEX ON DATA TO VENDAS
	CENTRA(14,25,55,"100%")
ENDIF
CENTRA(14,25,55,"100%")
INKEY(0.8)
SET CURSO ON
CLOSE ALL
RESTORE SCREEN FROM VTELAINDEX
RETURN
*********************	
FUNCTION CLIENTE
********************
	PARAMETERS VCHAVE
	USE CLIENTE INDEX CLIENTE1 INDEX CLIENTE2

	PRIVATE VCOLOR,VTELA,VCAMPOS[4],VCABEC[4],VLIN,VCOL,VRET

	VLIN = ROW()
	VCOL = COL()
	
   SAVE SCREEN TO VTELA12
	VCOLOR = SETCOLOR()

	
	VCABEC[1] = "EMPRESA"
	VCABEC[2] = "PLACA"
	VCABEC[3] = "NOME"
*	VCABEC[4] = "DEPENDENTE 2"	
	
	VCAMPOS[1] = "EMP"
	VCAMPOS[2] = "PLACA"
	VCAMPOS[3] = "NOME"
*	VCAMPOS[4] = "DEP2"	

	SEEK VCODIGO
	
	IF .NOT. EOF()
		VCODIGO = PLACA
	ELSE
		VCODIGO = ""
	ENDIF
	
	SET ORDER TO 2
	
	IF EMPTY(VCODIGO)
		GOTO TOP
	ELSE
		SEEK VCODIGO
	ENDIF
		@ 08,24 CLEAR TO 21,76
	@ 08,24 TO 21,76

	CENTRA(09,25,76,"Procura de Cliente")
	DBEDIT(10,25,20,75,VCAMPOS,"ACHALETRA",0,VCABEC)
	IF LASTKEY() # 27
		VCODIGO = PLACA
		KEYBOARD CHR(13)		
	ELSE
		VRET = ""
		KEYBOARD CHR(13)
		VUPD = .T.
	ENDIF
	
	SET ORDER TO 1

	@ VLIN,VCOL
	SETCOLOR(VCOLOR)
        RESTORE SCREEN FROM VTELA12
       
	RETURN VCODIGO
*********************	
FUNCTION DELCLIENTE
********************
	PARAMETERS VCHAVE
	USE CLIENTE INDEX CLIENTE1 INDEX CLIENTE2

	PRIVATE VCOLOR,VTELA,VCAMPOS[4],VCABEC[4],VLIN,VCOL,VRET

	VLIN = ROW()
	VCOL = COL()
	
   SAVE SCREEN TO VTELA12
	VCOLOR = SETCOLOR()

	
	VCABEC[1] = "NOME"
	VCABEC[2] = "Placa"
*	VCABEC[3] = "DEPENDENTE 1"
*	VCABEC[4] = "DEPENDENTE 2"	
	
	VCAMPOS[1] = "NOME"
	VCAMPOS[2] = "PLACA"
*	VCAMPOS[3] = "DEP1" 
*	VCAMPOS[4] = "DEP2"	

	SEEK VCODIGO
	
	IF .NOT. EOF()
		VCODIGO = PLACA
	ELSE
		VCODIGO = ""
	ENDIF
	
	SET ORDER TO 2
	
	IF EMPTY(VCODIGO)
		GOTO TOP
	ELSE
		SEEK VCODIGO
	ENDIF
	@ 08,24 CLEAR TO 21,76
	@ 08,24 TO 21,76
	CENTRA(09,25,76,"Dele‡ao de Cliente")

	DBEDIT(10,25,20,75,VCAMPOS,"ACHALETRA",0,VCABEC)
			@ 16,40 CLEAR TO 19,65
			@ 16,40 TO 19,65
				CENTRA(17,40,65,"Confimar Dele‡ao")
				@ 18,45 PROMPT " SIM "
				@ 18,53 PROMPT " NAO "
				MENU TO VOP
					DO CASE 
					CASE VOP=0
					
					CASE VOP=1
						DELE

			ENDCASE
	IF LASTKEY() # 27
		VCODIGO = PLACA
		KEYBOARD CHR(13)		
	ELSE
		VRET = ""
		KEYBOARD CHR(13)
		VUPD = .T.
	ENDIF
	
	SET ORDER TO 1

	@ VLIN,VCOL
	SETCOLOR(VCOLOR)
        RESTORE SCREEN FROM VTELA12
       
	VCODIGO = "       "
	RETURN VCODIGO

*******************
FUNCTION PRODUTO
*******************
PARAMETERS VCHAVE

USE PRODUTO INDEX PRODUTO1 INDEX PRODUTO2

PRIVATE VCOLOR,VTELA,VCAMPOS[4],VCABEC[4],VLIN,VCOL,VRET

VLIN = ROW()
VCOL = COL()
	
SAVE SCREEN TO VTELA
VCOLOR = SETCOLOR()




VCABEC[1] = "DESCRICAO"
VCABEC[2] = "CODIGO"
VCABEC[3] = "VALOR"

VCAMPOS[1] = "DESCRICAO"
VCAMPOS[2] = "CODP"
VCAMPOS[3] = "VALOR"

SEEK VCODP
	
IF .NOT. EOF()
	VCODP = CODP
ELSE
	VCODP = ""
ENDIF
	
SET ORDER TO 2
	
IF EMPTY(VCODP)
	GOTO TOP
ELSE
	SEEK VCODP
ENDIF
@ 08,24 CLEAR TO 21,76
@ 08,24 TO 21,76
@ 09,25 SAY SPACE(51)
CENTRA(09,25,76,"Procura de Produto")
DBEDIT(10,25,20,75,VCAMPOS,"ACHALETRA",0,VCABEC)

IF LASTKEY() # 27
	VCODP = CODP
	KEYBOARD CHR(13)		
ELSE
	VRET = ""
	KEYBOARD CHR(13)
	VUPD = .T.
ENDIF
	
SET ORDER TO 1

@ VLIN,VCOL
SETCOLOR(VCOLOR)
RESTORE SCREEN FROM VTELA
RETURN VCODP


RETURN VCODPROD



*******************
FUNCTION DELPRODUTO
*******************
PARAMETERS VCHAVE

USE PRODUTO INDEX PRODUTO1 INDEX PRODUTO2

PRIVATE VCOLOR,VTELA,VCAMPOS[4],VCABEC[4],VLIN,VCOL,VRET

VLIN = ROW()
VCOL = COL()
	
SAVE SCREEN TO VTELA
VCOLOR = SETCOLOR()

VCABEC[1] = "DESCRICAO"
VCABEC[2] = "CODIGO"
VCABEC[3] = "VALOR"

VCAMPOS[1] = "DESCRICAO"
VCAMPOS[2] = "CODP"
VCAMPOS[3] = "VALOR"

SEEK VCODP
	
IF .NOT. EOF()
	VCODP = CODP
ELSE
	VCODP = ""
ENDIF
	
SET ORDER TO 2
	
IF EMPTY(VCODP)
	GOTO TOP
ELSE
	SEEK VCODP
ENDIF
@ 08,24 CLEAR TO 21,76
@ 08,24 TO 21,76
CENTRA(09,25,76,"Dele‡ao de Produto")
DBEDIT(10,25,20,75,VCAMPOS,"ACHALETRA",0,VCABEC)
			@ 16,40 CLEAR TO 19,65
				@ 16,40 TO 19,65
				CENTRA(17,40,65,"Confimar Dele‡ao")
				@ 18,45 PROMPT " SIM "
				@ 18,53 PROMPT " NAO "
				MENU TO VOP
					DO CASE 
					CASE VOP=0
					
					CASE VOP=1
						DELE

			ENDCASE


IF LASTKEY() # 27
	VCODP = CODP
	KEYBOARD CHR(13)		
ELSE
	VRET = ""
	KEYBOARD CHR(13)
	VUPD = .T.
ENDIF
	
SET ORDER TO 1

@ VLIN,VCOL
SETCOLOR(VCOLOR)
RESTORE SCREEN FROM VTELA
VCODP="     "
RETURN VCODP




*****************
 PROCEDURE REO
*****************
SAVE SCREEN TO VTELAINDEX
@ 11,30 TO 13,50
CENTRA(12,25,55,"A g u a r d e")
IF VINDEX = "1" .OR. VINDEX = "T"
	USE CLIENTE
		INDEX ON PLACA TO CLIENTE1
		INDEX ON NOME TO CLIENTE2
ENDIF
IF VINDEX = "2" .OR. VINDEX = "T"
	USE PRODUTO
		INDEX ON CODP TO PRODUTO1
		INDEX ON DESCRICAO TO PRODUTO2
ENDIF
IF VINDEX - "T" .OR. VINDEX = "3"
	USE VENDAS
	INDEX ON DATA TO VENDAS
ENDIF
CLOSE ALL
RESTORE SCREEN FROM VTELAINDEX
RETURN
***************
FUNCTION PAUSE
***************
	PARAMETERS VKEY
	SET CURSO OFF
	INKEY(VKEY)
	SET CURSO ON
	RETURN .T.
**************
PROCEDURE DATA
**************
SAVE SCREEN TO VTELA
	@ 05,02 CLEAR TO 20,77
	VHORA=TIME()
	VDATA=DATE()
	@ 10,10 SAY "Hora..:  " GET VHORA PICT "99:99:99"
	@ 12,10 SAY "Data..:  " GET VDATA
	READ
	IF LASTKEY()#27
	 IF UPDATED()
*		DATA = DTOC(VDATA)
		SWPRUNCMD("TIME &VHORA",0,"","")
		SWPRUNCMD("DATE &VDATA",0,"","")
	 ENDIF
	ENDIF
RESTORE SCREEN FROM VTELA
RETURN
**************
PROCEDURE CABE
**************
SAVE SCREEN TO VTELA
	@ 05,02 CLEAR TO 20,77
	USE CONFIG
   VCA1=CA1
	VCA2=CA2
	VCA3=CA3
	VRO1=RO1
	VRO2=RO2
	VRO3=RO3
	@ 05,03 SAY "Cabecario"
	@ 06,03 TO 10,44
	@ 07,04 GET VCA1 PICT "@!"
	@ 08,04 GET VCA2 PICT "@!"
	@ 09,04 GET VCA3 PICT "@!"
	@ 11,03 SAY "Rodape"
	@ 12,03 TO 16,44
	@ 13,04 GET VRO1 PICT "@!"
	@ 14,04 GET VRO2 PICT "@!"
	@ 15,04 GET VRO3 PICT "@!"
	READ
	IF LASTKEY()#27
		REPLACE CA1 WITH VCA1
		REPLACE CA2 WITH VCA2
		REPLACE CA3 WITH VCA3
		REPLACE RO1 WITH VRO1
		REPLACE RO2 WITH VRO2
		REPLACE RO3 WITH VRO3
	ENDIF
RESTORE SCREEN FROM VTELA
RETURN
**************
PROCEDURE LOCA
**************
*****************
PROCEDURE PESSOAL
*****************
SAVE SCREEN TO VTELA
	USE CONFIG
	GO TOP
	VNOME=NOME
	VEND=END
	VCPF=CPF
	VTEL=TEL
	VBAIRRO=BAIRRO
	VUF=UF
	@ 05,02 CLEAR TO 20,77
	@ 07,10 TO 18,52
	@ 08,11 SAY "Empresa.."
	@ 09,11 GET VNOME PICT "@!"
	@ 10,11 SAY "Endereco "
	@ 11,11 GET VEND PICT "@!"
	@ 12,11 SAY "Bairro / Cidade"
	@ 13,11 GET VBAIRRO PICT "@!"
	@ 14,11 SAY "CPF"  
	@ 15,11 GET VCPF PICT "@!"
	@ 16,11 SAY "Tel.."
	@ 17,11 GET VTEL PICT "@!"
	READ
	IF LASTKEY()#27
		REPLACE NOME WITH VNOME, END WITH VEND, CPF WITH VCPF
		REPLACE BAIRRO WITH VBAIRRO, TEL WITH VTEL
	ENDIF
RESTORE SCREEN FROM VTELA
RETURN
****************
FUNCTION MOSPROD1
****************
PARAMETERS VCHAVE

VARQ=ALIAS()

SELE PRODUTO

PRIVATE VCOLOR,VTELA,VCAMPOS[4],VCABEC[4],VLIN,VCOL,VRET

VLIN = ROW()
VCOL = COL()
	
SAVE SCREEN TO VTELA
VCOLOR = SETCOLOR()

RODAPE(CHR(24)+CHR(25)+CHR(26)+CHR(27)+" examina  ENTER Confirmar  ESC desiste",.F.)

SET COLOR TO &VCDBED
@ 10,28 CLEAR TO 10,75
@ 10,29 TO 20,29 DOUBLE
@ 10,76 TO 20,76 DOUBLE

VCABEC[1] = "DESCRICAO"
VCABEC[2] = "CODIGO"
VCABEC[3] = "ATORES"
	
VCAMPOS[1] = "DESCRICAO"
VCAMPOS[2] = "CODPROD" 
VCAMPOS[3] = "ATORES" 

SEEK VCOD[X]
	
IF .NOT. EOF()
	VCOD[X] = CODPROD
ELSE
	VCOD[X] = ""
ENDIF
	
SET ORDER TO 2
	
GOTO TOP
@ 09,24 TO 21,76 DOUBLE
DBEDIT(10,25,20,75,VCAMPOS,"ACHALETRA",0,VCABEC)

IF LASTKEY() # 27

	VCOD[X]=CODPROD
	KEYBOARD CHR(13)		
ELSE
	VRET = ""
	KEYBOARD CHR(13)
	VUPD = .T.
ENDIF
	
SET ORDER TO 1

@ VLIN,VCOL
SETCOLOR(VCOLOR)
RESTORE SCREEN FROM VTELA

SELE &VARQ

RETURN VCOD[X]

********************
FUNCTION LUNDI
********************
PARAMETERS VCHAVE

VARQ=ALIAS()

SELE PRODUTO

PRIVATE VCOLOR,VTELA,VCAMPOS[4],VCABEC[4],VLIN,VCOL,VRET

VLIN = ROW()
VCOL = COL()
	
SAVE SCREEN TO VTELA
VCOLOR = SETCOLOR()

*RODAPE(CHR(24)+CHR(25)+CHR(26)+CHR(27)+" examina  ENTER Confirmar  ESC desiste",.F.)

SET COLOR TO &VCDBED
@ 10,28 CLEAR TO 10,75
@ 10,29 TO 20,29 DOUBLE
@ 10,76 TO 20,76 DOUBLE

VCABEC[1] = "DESCRICAO"
VCABEC[2] = "CODIGO"
VCABEC[3] = "ATORES"
	
VCAMPOS[1] = "DESCRICAO"
VCAMPOS[2] = "CODPROD"
VCAMPOS[3] = "ATORES" 

SEEK VCOD[X]
	
IF .NOT. EOF()
	VCOD = CODPROD
ELSE
	VCOD[X] = ""
ENDIF
	
SET ORDER TO 2
	
IF EMPTY(VCOD[X])
	GOTO TOP
ELSE
	SEEK VCOD[X]
ENDIF
@ 09,24 TO 22,76 DOUBLE
VKEY="" 
VCOR=SETCOLOR()
SET COLOR TO I/W
@ 21,25 SAY SPACE(51)
@ 21,25 SAY UPPER(VKEY)
SET COLOR TO I*/W				
@ 21,25+LEN(VKEY) SAY "_"
SET COLOR TO &VCOR
DBEDIT(10,25,20,75,VCAMPOS,"ACHALETRA",0,VCABEC)

IF LASTKEY() # 27
	VCODPROD = CODPROD
	VCOD[X]=CODPROD
	KEYBOARD CHR(13)		
ELSE
	VRET = ""
	KEYBOARD CHR(13)
	VUPD = .T.
ENDIF
	
SET ORDER TO 1

@ VLIN,VCOL
SETCOLOR(VCOLOR)
RESTORE SCREEN FROM VTELA

SELE &VARQ

RETURN VCOD[X]
FUNCTION ACHALETRA						&& pula para letra

	PARAMETERS VMODO,VCAMPO
	PRIVATE VRET
	
	IF VMODO=4 &&.AND. LASTKEY()>31 .AND. LASTKEY()<128
		IF LASTKEY()>31 .AND. LASTKEY()<128 .OR. LASTKEY()=8 	
			VKEYA=LASTKEY()
			IF VKEYA = 8 .OR. VKEYA = 19
				VKEY=LEFT(VKEY,LEN(VKEY)-1)
			ELSE
				VKEY = VKEY + CHR(VKEYA)
			ENDIF
			SET SOFTSEEK ON
			SEEK UPPER(VKEY)
			SET SOFTSEEK OFF
		ENDIF			
		VCOR=SETCOLOR()
		SET COLOR TO I/W
			@ 21,25 SAY SPACE(51)
			@ 21,25 SAY UPPER(VKEY)
		SET COLOR TO I*/W				
			@ 21,25+LEN(VKEY) SAY "_"
		SET COLOR TO &VCOR
		VRET = 2
		
	ELSE
	
		IF  LASTKEY()=27 .OR. LASTKEY()=13

			VRET = 0
				
		ELSE
			
			VRET = 1
		ENDIF

	ENDIF
	
	RETURN VRET
******************
PROCEDURE ANIMACAO
******************
SWPRUNCMD("DEMO 10",0,"","")
SAVE SCREEN TO VTELAA
X=0
Y=0
P="1"
SET COLOR TO W+/G
CLEAR
SOBRA(00,00,24,79,"W+/G","N/G")
DO WHILE .T.
	IF P="1"
		X=X+1
		P="2"
	ELSE	
		P="1"
		X=X-1
	ENDIF
	@ 10,X SAY "TESTE"
	PAUSE(0.5)
	IF LASTKEY()=0
		EXIT
	ENDIF
ENDDO
