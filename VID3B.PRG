**********************************
*	 MENHORES CLIENTE VID3B.PRG	*
**********************************
PRIVATE VCOND

SAVE SCREEN TO VTELA_CLIENTE
USE CLIENTE
*X = LASTREC()
X=0
SET CURSO OFF
IF LASTREC()>0
	VCONT = 21 / LASTREC() 
	VCONTA = 21 / LASTREC() 
	VBARRA = 100 / LASTREC()
	VBARRA1 = VBARRA
	VTOTALCONT = LASTREC()
ELSE
	VCONT = 0
	VCONTA = 0
	VBARRA = 0
	VBARRA1 = 0
	VTOTALCONT = LASTREC()
ENDIF
@ 17,15 CLEAR TO 19,37
@ 17,15 TO 19,38 DOUBLE
CENTRA(17,15,38,"[ Caculando ]")
@ 18,16 SAY REPLICATE("±",22)
VSAIR = .F.
DO WHILE .T.
	IF INKEY() = 27
		MSGBOX("Opera‡Æo Cancelada!")
		VSAIR = .T.
		EXIT
	ENDIF
	@ 18,16 + VCONT SAY "Û"
	CENTRA(19,15,37,"[ " + ALLTRIM(STR(VBARRA)) + " % ]")
	VBARRA = VBARRA + VBARRA1 
	VCONT = VCONT + VCONTA
	VCODIGO = STRZERO(X,6)
	USE LOCACAO2
	P  = 0
	DO WHILE !EOF()
		IF VCODIGO = CLIENTE
			P = P + 1
		ENDIF
		SKIP
	ENDDO
	USE CLIENTE INDEX CLIENTEA
	SEEK VCODIGO
	REPLACE FITAS WITH P
	X = X + 1
	IF X = VTOTALCONT
		EXIT
	ENDIF
ENDDO
@ 18,16 SAY REPLICATE ("Û",20)
IF	VSAIR = .F.
	USE CLIENTE INDEX CLIENTEB
	VCOND = "FITAS<>0"
	COPY TO VIDTEMP FOR &VCOND
	USE VIDTEMP
	IF EOF()
		MSGBOX("NÆo H  Cliente!")
	ELSE
		USE VIDTEMP
		INDEX ON FITAS TO  VIDTEMP 
		USE VIDTEMP INDEX VIDTEMP
*		SET DEVICE TO PRINT
*		SET PRINTER TO VIDEO
		GO BOTT
		X = 0
		@ 05,05 CLEAR TO 23,75
		@ 05,04 TO 23,75 DOUBLE
		@ 06,05 SAY "Codigo "
		@ 06,14 SAY "Nome "
		@ 06,58 SAY "N§ de Fitas"
		@ 07,05 TO 07,75 DOUBLE
		@ 07,04 SAY "Ì"
		@ 07,75 SAY "¹"
		@ 06,12 TO 22,12 DOUBLE
		@ 05,12 SAY "Ë"
		@ 23,12 SAY "Ê"
		@ 07,12 SAY "Î"
		@ 06,55 TO 22,55 DOUBLE
		@ 05,55 SAY "Ë"
		@ 23,55 SAY "Ê"
		@ 07,55 SAY "Î"
		GO BOTT
		DO WHILE .T.
			@ 08+X,06 SAY CODCLI
			@ 08+X,14 SAY NOME
			@ 08+X,58 SAY STRZERO(FITAS,6)
			SKIP -1
			IF X > 13
				EXIT
			ENDIF
			IF BOF()
				EXIT
			ENDIF
			X = X +1
		ENDDO
		CENTRA(23,05,75,"[ Enter Retorna ]")
		DO WHILE .T.
			A = INKEY(0)
			IF A = 13 .OR. LASTKEY() = 27
				EXIT
			ENDIF
		ENDDO
		IF SIMNAO(19,46,"Deseja Imprimir ?",.F.) = 1 .AND. LASTKEY()#27
			T_PRINT()
			IF LASTKEY() #27
				SET DEVICE TO PRINT
				*SET PRINTER TO VIDEO
				CENTRA(00,00,60,VCABE1)
				CENTRA(01,00,60,VCABE2)
				CENTRA(02,00,60,VCABE3)
				@ 04,02 SAY "Nome do Cliente "
				@ 04,45 SAY "Codigo "
				@ 04,53 say "N§"
				@ 05,00 SAY REPLICATE("=",60)
				VLINHA = 6
				GO BOTT
				DO WHILE .T.
					@ VLINHA,02 SAY NOME
					@ VLINHA,45 SAY CODCLI
					@ VLINHA,53 SAY STRZERO(FITAS,6)
					SKIP -1
					IF X > 13
						EXIT
					ENDIF
					IF BOF()
						EXIT
					ENDIF
*					X = X +1
					VLINHA = VLINHA + 1
				ENDDO	
				VLINHA = VLINHA + 2
				CENTRA(VLINHA,00,60,VRODA1)	
				VLINHA = VLINHA + 1
				CENTRA(VLINHA,00,60,VRODA2)	
				VLINHA = VLINHA + 1
				CENTRA(VLINHA,00,60,VRODA3)	
				VLINHA = VLINHA + 1
				SET DEVICE TO SCREEN
			ENDIF
		ENDIF
	ENDIF
ENDIF
SET CURSO ON
RESTORE SCREEN FROM VTELA_CLIENTE
RETURN