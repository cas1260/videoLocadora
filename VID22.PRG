***************************************************
* VId232 - INCLUSAO,ALTERACAO,EXCLUSAO DE PRODUTO *
***************************************************
SAVE SCREEN TO VTELA
DO WHILE .T.
	IF VPRODUTO = "N"
		NAO()
		EXIT
	ENDIF
	@ 05,03 CLEAR TO 20,77
	USE PRODUTO INDEX PRODUTOA INDEX PRODUTOB
	GO BOTT
	SKIP
	VCODIGO = CODPROD
	VDATA=DATE()
	VDESCRICAO=DESCRICAO
	VCLASSE=CLASSE
	VTIPO=TIPO
	VVRCOMPRA=0
	VATORES=ATORES
	VDUBLADO=DUBLADO
	VQTDLOC=QTDLOC
	VOBS=" " 
	VTEX1=OBSERVACAO
	VALORLOC=0
	IF LOCADO
		VLOCADO="S"
	ELSE
		VLOCADO="N"
	ENDIF
	VGRAVA = .T.	
	@ 06,03 CLEAR TO 19,77
	@ 08,20 SAY "DESCRICAO:"GET VDESCRICAO PICTURE "@!"
	@ 08,03 SAY "CODIGO: " + VCODIGO
	@ 10,03 SAY "ATORES:"GET VATORES PICTURE "@!"
	@ 12,03 SAY "CLASSE:"GET VCLASSE PICTURE "99"
	@ 14,03 SAY "TIPO:"GET VTIPO PICTURE "99" VALID B_TIPO(VTIPO)
*	@ 14,03 SAY "VALOR COMPRA:" GET VVRCOMPRA PICTURE "@E 9,999.99"
	@ 16,03 SAY "DUBLADO.:" GET VDUBLADO PICTURE "!" VALID VDUBLADO$"SN"
*	@ 16,25 SAY "LOCADO (S/N):"GET VLOCADO PICTURE "!" VALID VLOCADO$"SN"
	@ 18,03 SAY "OBSERVACAO (S/N):"GET VOBS PICTURE "!" VALID VOBS$"SN "
	@ 14,40 SAY "Valor "
	CLEAR GETS
	SET KEY -1 TO SHOW
	CENTRA(07,01,78,"[ F2 - PESQUISA ] ")
	@ 08,03 SAY "CODIGO:" GET VCODIGO PICT "99999"
	READ	
	SET KEY -1 TO
	IF LASTKEY() = 27
		EXIT
	ENDIF
	IF VCODIGO = SPACE(5)
		USE PRODUTO INDEX PRODUTOA INDEX PRODUTOB
		GO TOP
		X = 1
		DO WHILE !EOF()
			VCODIGO = STRZERO(X,5)
			SEEK VCODIGO
			X=X+1
		ENDDO
	ENDIF
	VCLASSE="00"
	VTIPO ="00"
	VCODIGO = STRZERO(VAL(VCODIGO),5)
	USE PRODUTO INDEX PRODUTOA INDEX PRODUTOB
	SEEK VCODIGO
	IF EOF()
		VDATA=DATE()
		VDESCRICAO=DESCRICAO
		VCLASSE=CLASSE
		VTIPO=STRZERO(VAL(TIPO),2)
		VVRCOMPRA=0
		VATORES=ATORES
		VDUBLADO=DUBLADO
		VQTDLOC=QTDLOC
		VOBS=" " 
		VTEX1=OBSERVACAO
		VALORLOC=0
		IF LOCADO
			VLOCADO="S"
		ELSE
			VLOCADO="N"
		ENDIF
		VGRAVA = .T.	
	ELSE
		VGRAVA = .F.
		VDATA=DATE()
		VCODIGO = CODPROD
		VDESCRICAO=DESCRICAO
		VCLASSE=CLASSE
		VTIPO=STRZERO(VAL(TIPO),2)
		VVRCOMPRA=0
		VATORES=ATORES
		VDUBLADO=DUBLADO
		VQTDLOC=QTDLOC
		VOBS=" " 
		VTEX1=OBSERVACAO
		VALORLOC=0
		IF LOCADO
			VLOCADO="S"
		ELSE
			VLOCADO="N"
		ENDIF
		VCODIGO = CODPROD
	ENDIF			
	@ 06,03 CLEAR TO 19,77
	@ 08,20 SAY "DESCRICAO:"GET VDESCRICAO PICTURE "@!"
	@ 08,03 SAY "CODIGO: " + VCODIGO
	@ 10,03 SAY "ATORES:"GET VATORES PICTURE "@!"
	@ 12,03 SAY "CLASSE:"GET VCLASSE PICTURE "99" VALID B_CLASSE(VCLASSE)
	@ 14,03 SAY "TIPO:"GET VTIPO PICTURE "99" VALID B_TIPO(VTIPO)
*	@ 14,03 SAY "VALOR COMPRA:" GET VVRCOMPRA PICTURE "@E 9,999.99"
	@ 16,03 SAY "DUBLADO.:" GET VDUBLADO PICTURE "!" VALID VDUBLADO$"SN"
*	@ 16,25 SAY "LOCADO (S/N):"GET VLOCADO PICTURE "!" VALID VLOCADO$"SN"
	@ 18,03 SAY "OBSERVACAO (S/N):"GET VOBS PICTURE "!" VALID VOBS$"SN "
	B_TIPO(VTIPO)	
	B_CLASSE(VCLASSE)
	READ
	IF LASTKEY()#27
	   IF VOBS="S"
			 SAVE SCREEN TO VTELAX
	       @ 13,06 TO 20,77
			 @ 13,08 SAY "RESUMO DO CONTRATO:[Ctrl + W Salvar]"
	       @ 14,07 CLEAR TO 19,76
*				 SET CURSOR ON
			 VTEX1=MEMOEDIT(VTEX1,14,8,19,75,.T.)
*			 SET CURSOR OFF
			 RESTORE SCREEN FROM VTELAX
		ENDIF
		USE PRODUTO INDEX PRODUTOA INDEX PRODUTOB
		SEEK VCODIGO
		IF VGRAVA = .T.
			APPEND BLANK
		ENDIF		
		REPLACE OBSERVACAO WITH VTEX1
		REPLACE DESCRICAO WITH VDESCRICAO
		REPLACE CLASSE WITH VCLASSE 
		REPLACE TIPO WITH VTIPO 
		REPLACE ATORES WITH VATORES
		REPLACE DUBLADO WITH VDUBLADO
*          REPALCE VRCOMPRA WITH VVRCOMPRA
		REPLACE CODPROD WITH VCODIGO
		REPLACE CODIGO WITH VCODIGO
		IF VLOCADO="S"
			REPLACE LOCADO WITH .T.
		ELSE
			REPLACE LOCADO WITH .F.
		ENDIF
	ENDIF
ENDDO

CLOSE DATABASES

RESTORE SCREEN FROM VTELA

SET KEY -3 TO

RETURN
***************
FUNCTION B_TIPO
***************
PARAMETERS VBUSCA
USE TIPO INDEX TIPOA
IF VBUSCA = SPACE(02) .OR. VBUSCA = "00"
	DO MOSTRATIPO 
	IF LASTKEY() = 27
		VBUSCA = "00"
	ELSE
		VBUSCA = VCODTIPO
	ENDIF
ENDIF
IF LASTKEY()#27
	VBUSCA = STRZERO(VAL(VBUSCA),2)
ENDIF
SEEK VBUSCA
IF EOF()
	VNOMETIPO = "[ TIPO INDEFINIDO ]"
	VVALORTIPO = 0
ELSE
	VNOMETIPO ="[ "+ NOMETIPO+" ]"
	VVALORTIPO = VALORTIPO
ENDIF
@ 14,15 SAY VNOMETIPO PICT "@!"
@ 14,40 SAY "Valor " + STR(VVALORTIPO)
VTIPO = STRZERO(VAL(VBUSCA),2)
@ 14,03 SAY "TIPO: "+ VTIPO 

RETURN .T.

FUNCTION B_CLASSE
*****************
PARAMETERS VBUSCA
*****************
IF VBUSCA = SPACE(02) .OR. VBUSCA = "00"
	DO	MOSTRACLASSE
	IF LASTKEY() = 27
		VBUSCAO = "00"
	ELSE
		VBUSCA = VCODCLAS
	ENDIF
ENDIF
USE CLASSE INDEX CLASSEA
VBUSCA = STRZERO(VAL(VBUSCA),2)
SEEK VBUSCA
IF !EOF()
	VNOMECLAS ="[ " + NOMECLAS + " ]"
ELSE
	VNOMECLAS = "[ CLASSE INDEFINIDA"+REPLICATE(" ",24)+"]"
ENDIF
@ 12,14 SAY VNOMECLAS PICT "@!"
VCLASSE = STRZERO(VAL(VBUSCA),2)
@ 12,03 SAY "CLASSE: " + VCLASSE
RETURN .T.
